# VSN-SunSpec Point Mapping Notes

## Overview

The VSN-SunSpec point mapping defines how data from VSN300/VSN700 dataloggers is
normalized to Home Assistant entities. The mapping is generated using a Python script
and maintained as the **single source of truth**.

**Current Version**: v1.2.0 (253 unique mappings)

## Generator Script (Single Source of Truth)

All sensor attributes are defined in the generator script:

```text
scripts/vsn-mapping-generator/generate_mapping.py
```text

**NEVER edit the JSON or Excel files directly.** All changes must go through the generator.

### Key Dictionaries in Generator

| Dictionary | Purpose |
|------------|---------|
| `SUNSPEC_TO_HA_METADATA` | Device class, state class, units, precision, icons |
| `DISPLAY_NAME_STANDARDIZATION` | User-facing display names |
| `DESCRIPTION_IMPROVEMENTS` | Detailed sensor descriptions |
| `VSN_NAME_NORMALIZATION` | VSN700â†’VSN300 name canonicalization |
| `DEVICE_CLASS_EXCEPTIONS` | Units without valid HA device_class |

## Statistics

### Current Coverage (v1.2.0)

- **Total Unique Mappings**: 253
- **Translation Entities**: 246

### By VSN Model Support

- **VSN300-only**: ~73 points (SunSpec-based names like `m103_1_W`)
- **VSN700-only**: ~10 points (ABB proprietary names)
- **Both Models**: ~170 points (common measurements)

### By Category

- Energy Counter: ~75 sensors
- Inverter: ~30 sensors
- Battery: ~20 sensors
- Meter: ~17 sensors
- Diagnostic: ~51 sensors
- Status/State: ~15 sensors
- System Monitoring: ~20 sensors

## Entity Naming Convention (v1.2.0+)

### Unique ID Format

```text
{domain}_{device_type}_{serial_compact}_{point_name}
```text

Example: `abb_fimer_pvi_vsn_rest_inverter_0779093g823112_e0_since_restart`

### Entity ID Format

Entity IDs are auto-generated by Home Assistant from device name + entity name.

Example: `sensor.abb_fimer_pvi_vsn_rest_inverter_0779093g823112_e0_since_restart`

### Display Name Pattern

```text
[Type] [AC/DC] - [Details] ([Time Period])
```text

Examples:

- `Energy AC - Produced (Lifetime)`
- `Power DC - String 1`
- `Temperature - Cabinet`
- `Energy AC - Apparent (Since Restart)`

## VSN Name Normalization (v1.1.12+)

VSN300 uses SunSpec-based names, VSN700 uses ABB proprietary names. When duplicates
exist, VSN300 names are canonical:

| VSN700 Name | VSN300 (Canonical) | Reason |
|-------------|-------------------|--------|
| `Riso` | `Isolation_Ohm1` | SunSpec standard |
| `IleakInv` | `ILeakDcAc` | SunSpec standard |
| `IleakDC` | `ILeakDcDc` | SunSpec standard |
| `Vgnd` | `VGnd` | Case normalization |
| `TSoc` | `Soc` | SunSpec standard |

## Time Period Suffixes (v1.2.0)

| REST API Suffix | Mapped Label | Entity ID Suffix |
|-----------------|--------------|------------------|
| `_runtime` | Since Restart | `_since_restart` |
| `_7D` | Current Week | `_last_week` |
| `_30D` | Current Month | `_last_month` |
| `_1Y` | Current Year | `_1_year` |
| (none/Total) | Lifetime | (varies) |

**Note**: `_runtime` sensors track energy since device restart, NOT lifetime totals.

## Workflow for Changes

### Adding/Modifying Sensor Attributes

1. Edit `scripts/vsn-mapping-generator/generate_mapping.py`
2. Add/modify entry in appropriate dictionary
3. Regenerate: `python scripts/vsn-mapping-generator/generate_mapping.py`
4. Convert: `python scripts/vsn-mapping-generator/convert_to_json.py`
5. Test changes
6. Commit generator + all generated files

### Generated Files

| File | Location | Purpose |
|------|----------|---------|
| Excel | `scripts/vsn-mapping-generator/output/vsn-sunspec-point-mapping.xlsx` | Human review |
| JSON (output) | `scripts/vsn-mapping-generator/output/vsn-sunspec-point-mapping.json` | Archive |
| JSON (runtime) | `custom_components/.../data/vsn-sunspec-point-mapping.json` | Integration uses |

## Related Documentation

- [MAPPING_FORMAT.md](MAPPING_FORMAT.md) - JSON structure and fields
- [CLAUDE.md](../CLAUDE.md) - Complete development guidelines
- [releases/v1.2.0.md](releases/v1.2.0.md) - Breaking change documentation

---

**Last Updated**: 2025-11-24
**Version**: v1.2.0 (253 mappings)
