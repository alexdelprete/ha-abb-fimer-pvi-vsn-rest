# v1.0.0-beta.15 - Point Mapping Data Quality Improvements

**Release Date:** 2025-11-03

## Overview

This release focuses on improving the quality and consistency of point descriptions and display names across all 258 mapped data points. The changes make entity names more
intuitive and consistent, following standardized naming conventions.

______________________________________________________________________

## Changed

### Fixed Temperature Units and Precision

**Problem:** Temperature sensors showed "degC" instead of "Â°C" and had 2 decimal precision.

**Solution:** Normalized temperature units to "Â°C" and changed display precision to 1 decimal for better readability.

**Points Fixed:** 4 temperature points (TmpCab, TempInv, TempBst, Temp1)

**Examples:**

- Unit: "degC" â†’ "Â°C"
- Precision: 2 decimals â†’ 1 decimal
- Display: "25.67Â°C" â†’ "25.7Â°C"

______________________________________________________________________

### Fixed Timestamp Sensor

**Problem:** System time sensor (sys_time) was providing Unix timestamp integer instead of datetime object, causing AttributeError.

**Solution:** Added conversion from Unix timestamp to datetime using Home Assistant's configured timezone (not UTC).

**Implementation:**

```python
# Convert Unix timestamps to datetime for timestamp device class
if self._attr_device_class == SensorDeviceClass.TIMESTAMP:
    tz = ZoneInfo(self.hass.config.time_zone)
    return datetime.fromtimestamp(value, tz=tz)
```text

______________________________________________________________________

### Standardized Energy Point Time Period Suffixes

**Problem:** Energy points used inconsistent time period suffixes: "total", "Total", "- total", "runtime", "lifetime total", "last week", "last 7 days", etc.

**Solution:** Standardized ALL 90+ energy points to use consistent suffixes:

- **"- Total"** for cumulative totals
- **"- Lifetime"** for lifetime/runtime values (was "- Runtime")
- **"- Week"** for weekly periods (was "last week", "last 7 days", "7D")
- **"- Month"** for monthly periods (was "last month", "last 30 days", "30D")
- **"- Year"** for yearly periods (was "last year", "1Y")
- **"- Today"** for daily periods (was "today", "day")

**Removed "counter" word** from all energy descriptions for conciseness:

- "Export energy counter" â†’ "Export energy"
- "Import energy counter" â†’ "Import energy"
- "Consumed energy counter" â†’ "Consumed energy"
- "Produced energy counter" â†’ "Produced energy"

**Points Updated:** 90+ energy points including:

- E0-E8 series (all periods: \_runtime, \_7D, \_30D, \_1Y)
- ETotal, Ein, ECharge, EDischarge
- EBackup, EGridImport, EGridExport
- ETotCharge, ETotDischarge (all periods)
- E15, Ein, ECharge, EDischarge (with periods)
- DayWH, WeekWH, MonthWH, YearWH
- MeterPgrid_Tot, HousePgrid_Tot, MeterQgrid_Tot, PbaT

**Examples:**

- "Export energy counter lifetime total" â†’ "Export energy - Lifetime"
- "Battery discharge energy last 7 days" â†’ "Battery discharge energy - Week"
- "PV production energy last month" â†’ "PV production energy - Month"
- "Meter active power total" â†’ "Meter active power - Total"

______________________________________________________________________

### Improved Additional Point Descriptions

**System and Storage Points:**

- **store_size**: "Flash storage used" (improved capitalization)
- **PF**: "Power factor" (simplified, removed "at grid connection point")
- **PowerPeakToday**: "Peak power output today" (improved clarity)
- **PowerPeakAbs**: "Peak absolute output power" (improved)
- **GlobState**: "Global operational state" (was "Glob State")
- **sys_load**: "System load average" (improved capitalization)

**Frequency and Control:**

- **Fcc**: "Central controller frequency" (simplified)
- **FRT_state**: "Fault Ride Through (FRT) status" (added acronym explanation)

**Energy Measurement:**

- **ECt**: "Total energy from current transformer (CT)" (added acronym)
- **EDt**: "Total energy from direct transducer (DT)" (added acronym)
- **ETotalApparent**: "Apparent energy - Total" (removed "in kVAh", unit shown separately)

**Display Names Updated:**

- **cosPhi**: "Power Factor" (removed "Cos Ï†" Greek symbol)
- **mfg_serial_number**: "Serial Number" â†’ "Manufacturing Week/Year" (restored "Manufacturing" prefix for clarity)
- **mfg_week_year**: "Week/Year" â†’ "Manufacturing Week/Year"

______________________________________________________________________

### Standardized Phase Naming to A/B/C/N Format

**Problem:** Phase-related points used inconsistent naming conventions mixing "phase A/B/C", "phase L1/L2/L3", and "(L1-L2)" notations, making entity names confusing and
inconsistent.

**Solution:** Standardized all phase-related descriptions and display names to use A/B/C/N notation consistently.

**Points Improved:** 40+ phase-related points

**Examples:**

**Phase Voltages (Line-to-Neutral):**

- Before: "Grid voltage phase A (L1) to neutral"
- After: "AC Voltage Phase A-N"
- Display Name: "AC Voltage A-N"

**Line-to-Line Voltages:**

- Before: "AC line-to-line voltage phase A-B (L1-L2)"
- After: "AC Voltage Phase A-B"
- Display Name: "AC Voltage A-B"

**Phase Currents:**

- Before: "Phase A AC current"
- After: "AC Current Phase A"
- Display Name: "Current Phase A"

**AC Frequency:**

- Before: "AC frequency for phase A"
- After: "AC Frequency Phase A"
- Display Name: "Frequency Phase A"

**Meter Points:**

- Before: "Meter active power phase L1"
- After: "Meter Power Phase A"
- Display Name: "Meter Power A"

**House Consumption:**

- Before: "House consumption phase L1 power"
- After: "House Power Phase A"
- Display Name: "House Power A"

**Affected Point Categories:**

- Phase voltages (A-N, B-N, C-N)
- Line-to-line voltages (A-B, B-C, C-A)
- Phase currents (A, B, C)
- AC frequency (A, B, C)
- Meter measurements (A, B, C)
- House consumption (A, B, C)

______________________________________________________________________

### Removed "measurement" Word from Descriptions

**Problem:** Many descriptions included the redundant word "measurement" (e.g., "DC current measurement for string 1"), making them unnecessarily verbose.

**Solution:** Systematically removed "measurement" from all descriptions while maintaining clarity.

**Points Improved:** 15+ points

**Examples:**

- Before: "Phase A AC current measurement"

- After: "AC Current Phase A"

- Before: "DC voltage measurement for string 1"

- After: "DC Voltage (String 1)"

- Before: "Grid frequency measurement"

- After: "Grid frequency"

______________________________________________________________________

### Standardized String References to "(String #)" Format

**Problem:** String-related points used verbose patterns like "for string 1", "from MPPT string 2", making descriptions unnecessarily long.

**Solution:** Replaced all string references with concise "(String #)" format in descriptions, and "#1/#2" format in display names.

**Points Improved:** 13 points

**Examples:**

**DC Measurements:**

- DCA_1: "DC current for string 1" â†’ "DC Current (String 1)" â†’ Display: "DC Current #1"
- DCW_2: "DC power for string 2" â†’ "DC Power (String 2)" â†’ Display: "DC Power #2"

**Energy Counters:**

- Ein1: "Total DC energy from MPPT string 1" â†’ "Total DC Energy (String 1)" â†’ Display: "String 1 Energy"

**String Power:**

- Pin: "Combined DC input power from all strings" â†’ "Total DC Input Power"
- Pin1: "DC input power from MPPT string 1" â†’ "DC Input Power (String 1)" â†’ Display: "String 1 Power"

______________________________________________________________________

### Fixed Specific Point Issues

#### GlobalSt Description

- Before: "Overall inverter operating state"
- After: "Global inverter status"
- Display Name: "Global Status"

#### logger_loggerId Repeated Word

- Before: "Logger Logger Id" (repeated word)
- After: "Logger ID"
- Description: "Logger ID"

#### VSN-Specific Points

- **InverterSt**: Now properly capitalized as "Inverter Status"
- **free_ram**: "Available RAM" (was "ram free")
- **flash_free**: "Available flash storage" (was "flash free")
- **logger_sn**: "Logger serial number" â†’ Display: "Logger Serial Number"

______________________________________________________________________

## Technical Details

### Code Quality

**Files Modified:** 6 files

- `custom_components/abb_fimer_pvi_vsn_rest/sensor.py` - Fixed timestamp conversion and temperature precision
- `scripts/vsn-mapping-generator/generate_mapping.py` - Added 150+ corrections to DESCRIPTION_IMPROVEMENTS and DISPLAY_NAME_CORRECTIONS
- `scripts/vsn-mapping-generator/output/vsn-sunspec-point-mapping.xlsx` - Regenerated with all improvements
- `custom_components/.../data/vsn-sunspec-point-mapping.json` - Regenerated with all improvements
- `docs/vsn-sunspec-point-mapping.xlsx` - Updated documentation
- `docs/releases/v1.0.0-beta.15.md` - This document

**Key Code Changes:**

**Temperature Fixes (sensor.py):**

```python
# Temperature precision: 1 decimal
elif units in ("V", "A", "mA", "%", "Ah", "Â°C", "Â°F"):
    self._attr_suggested_display_precision = 1

# Timestamp conversion with HA timezone
if self._attr_device_class == SensorDeviceClass.TIMESTAMP:
    tz = ZoneInfo(self.hass.config.time_zone)
    return datetime.fromtimestamp(value, tz=tz)
```text

**Energy Point Standardization (generate_mapping.py):**

```python
# Time period suffixes
"E0_runtime": "Export energy - Lifetime"
"E0_7D": "Export energy - Week"
"E0_30D": "Export energy - Month"
"E0_1Y": "Export energy - Year"

# Temperature units
TEMPERATURE_UNIT_FIX = {
    "degC": "Â°C",
    "Deg C": "Â°C",
    "deg C": "Â°C",
}

# Phase naming
"PhVphA": "AC Voltage Phase A-N"
"AphA": "AC Current Phase A"
"HzA": "AC Frequency Phase A"

# String references
"DCA_1": "DC Current (String 1)"
"Ein1": "DC energy (String 1) - Total"
"Pin": "Total DC Input Power"
```text

**Mapping Statistics:**

- Total points: 258
- Points improved: 180+ (70% of all points)
- New corrections added: 150+
- Energy points standardized: 90+
- Temperature points fixed: 4
- Consistent patterns: 100%

______________________________________________________________________

## Testing

**Verified:**

1. âœ“ All 258 points load correctly
1. âœ“ Temperature units show "Â°C" instead of "degC"
1. âœ“ Temperature sensors display with 1 decimal precision
1. âœ“ Timestamp sensor (sys_time) converts to datetime with HA timezone
1. âœ“ All energy point time periods use consistent suffixes (- Total, - Lifetime, - Week, - Month, - Year, - Today)
1. âœ“ No "counter" word in energy descriptions
1. âœ“ Phase naming is consistent across all points (A/B/C/N format)
1. âœ“ No "measurement" word in descriptions
1. âœ“ String references use concise "(String #)" format
1. âœ“ All improved point descriptions (GlobState, PowerPeakAbs, sys_load, store_size, PF, etc.)
1. âœ“ Display names are clean and concise (cosPhi, mfg_week_year)
1. âœ“ Excel and JSON mappings are in sync
1. âœ“ Generator script works correctly
1. âœ“ No ruff errors or warnings

______________________________________________________________________

## Breaking Changes

**None.** This release is fully backward compatible.

However, note that:

- Entity display names have changed for better readability (180+ entities, 70% of all points)
- Energy point descriptions changed significantly for standardization (90+ points)
- Temperature units changed from "degC" to "Â°C"
- Temperature precision changed from 2 to 1 decimal
- This might affect automations that use entity friendly names in their configuration
- Entity IDs and unique IDs remain unchanged, so automations using entity IDs are not affected
- All changes are cosmetic improvements to descriptions and display names

______________________________________________________________________

## Migration Notes

### For Users

**No action required.** Simply update the integration and restart Home Assistant.

**What to Expect:**

- Cleaner, more consistent entity names (180+ points improved)
- Better readability in the UI
- Standardized phase naming (A/B/C instead of L1/L2/L3)
- Standardized energy point time periods (- Lifetime, - Week, - Month, - Year, - Today)
- Temperature sensors show "Â°C" with 1 decimal precision
- Timestamp sensor works correctly with your timezone
- More concise, professional descriptions
- No changes to entity IDs or unique IDs

**If You Have Issues:**

1. Check Home Assistant logs for any errors
1. Verify your VSN device is accessible
1. Report issues at: <https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues>

### For Developers

**Mapping File Changes:**

- 180+ point descriptions improved (70% of all points)
- 150+ new corrections added to generator
- 90+ energy points standardized with consistent time period suffixes
- Phase naming standardized to A/B/C/N format
- String references use "(String #)" format
- Removed redundant "measurement" and "counter" words
- Temperature unit normalization (degC â†’ Â°C)
- All time periods follow "- Period" format

**Code Changes:**

```python
# sensor.py: Temperature precision
elif units in ("V", "A", "mA", "%", "Ah", "Â°C", "Â°F"):
    self._attr_suggested_display_precision = 1

# sensor.py: Timestamp conversion
if self._attr_device_class == SensorDeviceClass.TIMESTAMP:
    tz = ZoneInfo(self.hass.config.time_zone)
    return datetime.fromtimestamp(value, tz=tz)

# generate_mapping.py: Temperature unit fix
TEMPERATURE_UNIT_FIX = {
    "degC": "Â°C",
    "Deg C": "Â°C",
    "deg C": "Â°C",
}

# generate_mapping.py: Energy point standardization
"E0_runtime": "Export energy - Lifetime"
"E0_7D": "Export energy - Week"
"E0_30D": "Export energy - Month"
"E0_1Y": "Export energy - Year"
"ETotal": "Inverter produced energy - Total"

# generate_mapping.py: Phase naming
"PhVphA": "AC Voltage Phase A-N"
"AphA": "AC Current Phase A"

# generate_mapping.py: String references
"DCA_1": "DC Current (String 1)"
"Ein1": "DC energy (String 1) - Total"
```text

______________________________________________________________________

## Known Issues

**None reported.**

This is a **beta release** - please report any issues on GitHub:

- Issues: <https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues>
- Discussions: <https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/discussions>

______________________________________________________________________

## Upgrade Instructions

### HACS (Recommended)

1. Go to HACS â†’ Integrations
1. Find "ABB/FIMER PVI VSN REST"
1. Click "Update"
1. Restart Home Assistant

### Manual Installation

1. Download release from GitHub
1. Extract to `custom_components/abb_fimer_pvi_vsn_rest/`
1. Restart Home Assistant

______________________________________________________________________

## Links

- **Repository:** https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest
- **Issues:** https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues
- **Discussions:** https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/discussions
- **CHANGELOG:** [CHANGELOG.md](../../CHANGELOG.md)

______________________________________________________________________

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)
