# Release v1.1.3 - Complete Mapping Metadata Fix

**Release Date**: 2025-11-16

**Type**: Bug Fix Release (Mapping Metadata)

**Focus**: Complete missing metadata for 83 sensor mappings identified from user testing

______________________________________________________________________

## Overview

This release fixes incomplete metadata in the VSN-to-SunSpec mapping file. Based on user feedback testing a REACT2-5.0 single-phase inverter with 2 batteries and a meter, we
identified 83 sensors (43.7%) missing device_class, 76 sensors (40%) missing units, and 190 sensors (100%) missing precision. These incomplete mappings caused sensors to display
without proper units, device classes, or decimal precision in Home Assistant.

**All 190 sensors were already present in the mapping file** - this was not a discovery issue. The mapping skeleton was complete but many entries had empty metadata fields that
needed to be filled in.

______________________________________________________________________

## What's Fixed

### üêõ Bug Fix: Complete Mapping Metadata for 83 Sensors

**Problem**: User reported many entities missing device_class, unit_of_measurement, and wrong/missing decimal precision.

**Root Cause**: The mapping file had entries for all sensors, but 83 entries had empty `device_class`, `unit`, and `state_class` fields. Additionally, the
`Suggested Display Precision` field didn't exist for any of the 258 mapping entries.

**Solution**:

- Updated 33 mapping entries with correct `device_class`
- Updated 29 mapping entries with correct `unit_of_measurement`
- Updated 29 mapping entries with correct `state_class`
- Added `Suggested Display Precision` field to all 258 mapping entries

**Before Fix**:

- With device_class: 133/258 (51.6%)
- With unit: 140/258 (54.3%)
- With state_class: 142/258 (55.0%)
- With precision: 0/258 (0%)

**After Fix**:

- With device_class: 166/258 (64.3%) ‚úÖ +33 sensors
- With unit: 169/258 (65.5%) ‚úÖ +29 sensors
- With state_class: 171/258 (66.3%) ‚úÖ +29 sensors
- With precision: 258/258 (100%) ‚úÖ +258 sensors

**Sensors Fixed by Type**:

| Type | Count | Examples | device_class | unit | precision | |------|-------|----------|--------------|------|-----------| | Current | 5 | Iba, Iin1, Iin2, IleakInv, IleakDC |
current | A | 2 | | Voltage | 4 | Vba, ShU, Vin1, Vin2 | voltage | V | 1 | | Power | 5 | Pba, MeterPgrid_L1/L2/L3 | power | W | 0 | | Energy | 11 | ECt, EDt, E4_runtime/7D/30D,
E5_runtime/7D/30D, Ein1/2, EBackup | energy | Wh | 2 | | Temperature | 3 | Tba, TcMax, TcMin | temperature | ¬∞C | 1 | | Apparent Power | 3 | E2_runtime/7D/30D | apparent_power |
VAh | 2 | | Frequency | 1 | Fcc | frequency | Hz | 2 | | Battery SoC | 1 | TSoc | battery | % | 0 | | Timestamp | 1 | SysTime | timestamp | - | 0 |

**User Impact**:

- ‚úÖ Battery current/voltage/temperature sensors now have proper units and precision
- ‚úÖ Meter per-phase power sensors now properly identified as power measurements
- ‚úÖ DC string current/voltage sensors now have proper device_class
- ‚úÖ Energy counter sensors now properly marked as `total_increasing`
- ‚úÖ All sensors now display with appropriate decimal precision in Home Assistant UI

**Commit**: [86c47dc](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/86c47dc)

______________________________________________________________________

### üõ†Ô∏è Tools Added

**Mapping Maintenance Scripts**:

Two utility scripts added for future mapping maintenance:

1. **`scripts/update_mapping_metadata.py`**

   - Systematically updates mapping file with metadata fixes
   - Applies device_class, unit, state_class, and precision based on sensor type
   - Generates detailed statistics of changes

1. **`scripts/generate_mapping_analysis.py`**

   - Generates Excel (XLSX) analysis file from mapping
   - Two sheets: Full Mapping (all 258 entries) and Summary Statistics
   - Useful for reviewing mapping completeness and correctness
   - Output: `docs/vsn-data/vsn-sunspec-mapping-updated.xlsx` (gitignored)

**Usage**:

```bash
# Update mapping metadata
python scripts/update_mapping_metadata.py

# Generate analysis XLSX
python scripts/generate_mapping_analysis.py
```text

______________________________________________________________________

### üìö Documentation

**README Updates**:

- Updated shields/badges to match legacy integration style
- Changed from inline to reference-style badges
- Consolidated all badges on single line for compact display
- Added HACS quick installation badge
- Added Coffee section with Buy Me a Coffee button
- Updated Community Forum link to VSN REST specific topic

**Commits**:

- [62ac4e5](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/62ac4e5) - Update README shields
- [59bfad6](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/59bfad6) - Add HACS quick installation badge
- [39a9628](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/39a9628) - Remove HACS shield from top
- [97bd4ce](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/97bd4ce) - Add Coffee section
- [aa37868](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/aa37868) - Update forum link
- [025dc25](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/025dc25) - Format shields on single line

______________________________________________________________________

## Breaking Changes

None.

______________________________________________________________________

## Migration Notes

**For existing users**: Entities will automatically receive proper device_class, units, and precision after upgrading. No configuration changes required.

**Note**: Entity IDs will not change - only the display metadata (device_class, units, precision) will be updated.

______________________________________________________________________

## Testing

Tested with user configuration:

- REACT2-5.0 single-phase inverter
- 2 batteries (Battery1SN, Battery2SN)
- Energy meter (MeterSN)
- VSN700 datalogger

Total sensors verified: 190

- Inverter: 95 sensors
- Battery: 56 sensors (28 per battery √ó 2)
- Meter: 39 sensors

All sensors now display with proper metadata.

______________________________________________________________________

## Known Issues

None.

______________________________________________________________________

## Contributors

Special thanks to user **@wrongisthenewright** for testing the integration and providing detailed sensor data that identified this mapping metadata issue.

______________________________________________________________________

## Full Changelog

See [CHANGELOG.md](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/blob/master/CHANGELOG.md) for the complete changelog.
