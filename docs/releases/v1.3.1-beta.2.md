# Release Notes - v1.3.1-beta.2

## Overview

This beta release adds configurable repair notifications with recovery script support, allowing users to automate responses to connection failures.

## New Features

### Configurable Repair Notifications

New options in the integration configuration:

- **Enable/disable repair notifications** - Turn off failure notifications if desired (default: enabled)
- **Configurable failures threshold** - Set how many consecutive failures (1-10) before triggering notification (default: 3)
- **Recovery script execution** - Configure a Home Assistant script to run when failure threshold is reached

### Recovery Script Support

When the failure threshold is reached, the integration can automatically execute a Home Assistant script:

- Configure any script entity (e.g., `script.restart_router`, `script.power_cycle_datalogger`)
- Script execution time is tracked and shown in the recovery notification
- Useful for automating recovery of intermittent network issues

### Improved Notifications

- Uses `persistent_notification` instead of repair issues for recovery notifications
- Full message with timestamps displayed immediately when notification appears
- No duplicate notifications after acknowledging

## Code Quality Improvements

### Linting Fixes

- **Ruff formatting** - All Python code formatted to project standards
- **Yamllint compliance** - All YAML files pass linting
- **Markdown linting** - All 60 documentation files pass pymarkdown validation

### Files Updated

- `__init__.py` - Options migration for existing config entries
- `config_flow.py` - New options flow fields
- `const.py` - New configuration constants
- `coordinator.py` - Notification logic and script execution
- `repairs.py` - Refactored for persistent notifications
- All 10 translation files updated (de, en, es, et, fi, fr, it, nb, pt, sv)

## Configuration Options

| Option | Default | Range | Description |
|--------|---------|-------|-------------|
| Enable repair notifications | Enabled | On/Off | Show notifications on connection failures |
| Failures threshold | 3 | 1-10 | Consecutive failures before notification |
| Recovery script | (none) | Any script entity | Script to execute on failure |

## Installation

### HACS (Recommended)

1. Open HACS in Home Assistant
2. Go to Integrations
3. Search for "ABB/FIMER PVI VSN REST"
4. Install the integration
5. Restart Home Assistant

### Manual Installation

1. Download the latest release
2. Copy the `custom_components/abb_fimer_pvi_vsn_rest` folder to your Home Assistant config
3. Restart Home Assistant

## Beta Testing

This is a beta release. Please report any issues at: <https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues>

## Full Changelog

See [CHANGELOG.md](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/blob/master/CHANGELOG.md) for complete history.
