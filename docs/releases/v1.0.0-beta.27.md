# Release v1.0.0-beta.27

**Release Date**: 2025-11-13

**Type**: Bug Fix Release

**Focus**: Fix sensor display issues and value cleanup

---

## Overview

This release fixes three sensor-specific issues reported by users:

1. **system_load sensor** - Too many decimal places (0.05419921875 ‚Üí 0.05)
2. **isolation_ohm1 sensor** - Missing appropriate icon
3. **model sensor** - Leading/trailing dashes in value (-3G82- ‚Üí 3G82)

All fixes are targeted, minimal changes that follow existing code patterns.

---

## Bug Fixes

### üêõ system_load - Fixed Excessive Decimal Places

**Problem**: The `system_load` sensor was displaying values with excessive decimal precision:
```
Current: 0.05419921875
Expected: 0.05
```

**Root Cause**:
- Beta.21 attempted to fix this using `suggested_display_precision = 2`
- However, this property doesn't work reliably for sensors **without units**
- The `system_load` sensor has `unit_of_measurement: ""` (empty) in the mapping file
- Home Assistant ignores display precision hints when there's no unit

**Solution**:
Instead of relying on `suggested_display_precision`, we now **round the value** in the `native_value` property before returning it.

**Code Change** ([sensor.py:446-448](d:\OSILifeDrive\Dev\HASS\ha-abb-fimer-pvi-vsn-rest\custom_components\abb_fimer_pvi_vsn_rest\sensor.py#L446-L448)):
```python
# Round system_load to 2 decimals (suggested_display_precision not working without units)
if self._point_name == "system_load" and isinstance(value, (int, float)):
    return round(value, 2)
```

**Result**:
- ‚úÖ Value stored in state: `0.05`
- ‚úÖ Displayed in UI: `0.05`
- ‚úÖ Proper precision maintained across all platforms

---

### üé® isolation_ohm1 - Added Omega Icon

**Problem**: The `isolation_ohm1` (Resistance - Insulation) sensor had no icon.

**Solution**: Set icon to `mdi:omega` (Œ© symbol) - the standard symbol for electrical resistance.

**Code Change** ([vsn-sunspec-point-mapping.json:1328](d:\OSILifeDrive\Dev\HASS\ha-abb-fimer-pvi-vsn-rest\custom_components\abb_fimer_pvi_vsn_rest\data\vsn-sunspec-point-mapping.json#L1328)):
```json
"HA Icon": "mdi:omega",
```

**Result**:
- ‚úÖ Sensor displays with Œ© icon in UI
- ‚úÖ Appropriate visual representation for resistance measurement (MŒ©)
- ‚úÖ Consistent with electrical engineering standards

---

### üßπ model - Strip Leading/Trailing Dashes

**Problem**: The `model` (Model identifier) sensor was showing values with leading/trailing dashes:
```
Current: -3G82-
Expected: 3G82
```

**Root Cause**:
- The normalizer has a `STRING_STRIP_POINTS` registry for cleaning up string values
- This registry already includes `"pn"` (product number)
- However, it was missing `"C_Md"` (the VSN REST API name for model identifier)

**Solution**: Add `"C_Md"` to the `STRING_STRIP_POINTS` registry. The existing `strip("-")` logic handles the cleanup.

**Code Change** ([normalizer.py:38-41](d:\OSILifeDrive\Dev\HASS\ha-abb-fimer-pvi-vsn-rest\custom_components\abb_fimer_pvi_vsn_rest\abb_fimer_vsn_rest_client\normalizer.py#L38-L41)):
```python
# String cleanup registry: Points that need value cleanup
STRING_STRIP_POINTS = {
    "pn",    # Product number - strip leading/trailing dashes
    "C_Md",  # Model identifier - strip leading/trailing dashes
}
```

**Result**:
- ‚úÖ Leading dashes removed: `-3G82-` ‚Üí `3G82`
- ‚úÖ Trailing dashes removed: `-3G82-` ‚Üí `3G82`
- ‚úÖ Internal dashes preserved: `PVI-10.0-OUTD` ‚Üí `PVI-10.0-OUTD` (unchanged)

**Note**: Python's `str.strip("-")` only removes leading and trailing characters, not internal ones. This is the desired behavior.

---

## Technical Details

### File Changes Summary

| File | Lines | Change |
|------|-------|--------|
| sensor.py | 446-448 | Added value rounding for system_load |
| vsn-sunspec-point-mapping.json | 1328 | Set icon to mdi:omega for isolation_ohm1 |
| normalizer.py | 40 | Added C_Md to STRING_STRIP_POINTS |
| manifest.json | 13 | Version bump to 1.0.0-beta.27 |
| const.py | 4 | Version bump to 1.0.0-beta.27 |

### Before & After Examples

#### system_load Sensor

**Before (beta.26)**:
```
Entity ID: sensor.abb_datalogger_vsn300_111033_3n16_1421_system_load
Value: 0.05419921875
Display Name: "System load average"
```

**After (beta.27)**:
```
Entity ID: sensor.abb_datalogger_vsn300_111033_3n16_1421_system_load
Value: 0.05
Display Name: "System load average"
```

#### isolation_ohm1 Sensor

**Before (beta.26)**:
```
Entity ID: sensor.power_one_inverter_pvi_10_0_outd_077909_3g82_3112_isolation_ohm1
Value: 250.5 MŒ©
Icon: (none)
Display Name: "Resistance - Insulation"
```

**After (beta.27)**:
```
Entity ID: sensor.power_one_inverter_pvi_10_0_outd_077909_3g82_3112_isolation_ohm1
Value: 250.5 MŒ©
Icon: mdi:omega (Œ©)
Display Name: "Resistance - Insulation"
```

#### model Sensor

**Before (beta.26)**:
```
Entity ID: sensor.power_one_inverter_pvi_10_0_outd_077909_3g82_3112_model
Value: "-3G82-"
Display Name: "Model identifier"
```

**After (beta.27)**:
```
Entity ID: sensor.power_one_inverter_pvi_10_0_outd_077909_3g82_3112_model
Value: "3G82"
Display Name: "Model identifier"
```

---

## Migration Guide

### ‚ö†Ô∏è NO BREAKING CHANGES

This release **does not** require any migration:
- ‚úÖ No entity ID changes
- ‚úÖ No configuration changes
- ‚úÖ No entity registry cleanup needed

Simply upgrade to beta.27 and restart Home Assistant. The fixes take effect immediately.

### Upgrade Steps

1. **Download beta.27** via HACS or manual installation
2. **Restart Home Assistant**
3. **Verify the fixes**:
   - Check `system_load` shows 2 decimal places (e.g., 0.05)
   - Check `isolation_ohm1` has Œ© icon
   - Check `model` has no leading/trailing dashes

---

## Compatibility

- **Home Assistant**: 2024.1.0 or later
- **Python**: 3.11 or later
- **VSN Dataloggers**: VSN300, VSN700
- **Inverters**: ABB, FIMER, Power-One PVI series

---

## Known Issues

None - This is a pure bug fix release.

---

## What's Next

### Planned for v1.0.0-beta.28+

- Continue bug fixes and improvements based on user feedback
- Move towards stable v1.0.0 release once beta testing is complete
- Additional sensor refinements as needed

---

## Full Changelog

See [CHANGELOG.md](../../CHANGELOG.md) for complete version history.

---

## Contributors

- **Bug Reports & Testing**: @alexdelprete (maintainer)
- **Development**: Claude Code (AI Assistant)
- **Project Maintainer**: @alexdelprete

---

## References

- **system_load precision issue**: Fixed in beta.21 (commit 6eacb18), properly fixed in beta.27
- **Entity naming improvements**: beta.26 (November 12, 2025)
- **This release**: v1.0.0-beta.27 (November 13, 2025)

---

ü§ñ This release was generated with [Claude Code](https://claude.com/claude-code)
