# v1.0.0-beta.20 - Device Name Fix & Aurora Protocol Documentation

**Release Date**: 2025-11-05

## Overview

This release fixes device name serial number truncation and adds comprehensive Aurora protocol documentation references.

## Highlights

### ðŸ”§ Device Name Serial Number Fix

**Problem**: Device names were showing truncated serial numbers (8 characters) instead of the full serial number.

**Example**:

- Before: `ABB/FIMER Datalogger VSN300 (111033-3N)`
- After: `ABB/FIMER Datalogger VSN300 (111033-3N16-1421)`

**Technical Details**:

The `_format_device_name()` function was using a compacted 8-character serial number for display purposes. This has been changed to use the full original serial number with dashes
preserved.

```python
# Before
def _format_device_name(
    manufacturer: str,
    device_type_simple: str,
    device_model: str | None,
    device_sn_compact: str,  # 8-char compact version
) -> str:
    sn_display = device_sn_compact.upper()
    ...

# After
def _format_device_name(
    manufacturer: str,
    device_type_simple: str,
    device_model: str | None,
    device_sn_original: str,  # Full serial with dashes
) -> str:
    sn_display = device_sn_original.upper()
    ...
```text

**Impact**:

- Hub device name now shows full serial number
- All device names show complete serial identification
- Better device identification in Home Assistant UI

### ðŸ“š Aurora Protocol Documentation

Added comprehensive references to the official Aurora Communication Protocol v4.2 documentation:

**References Added**:

- Online:
  [https://mischianti.org/wp-content/uploads/2022/01/AuroraCommunicationProtocol_4_2.pdf](https://mischianti.org/wp-content/uploads/2022/01/AuroraCommunicationProtocol_4_2.pdf)
- Local: `docs/AuroraCommunicationProtocol_4_2.pdf`

**Documentation Sections Updated**:

1. **AURORA_EPOCH_OFFSET constant** ([const.py:27-31](../../custom_components/abb_fimer_pvi_vsn_rest/const.py#L27-L31)):

```python
# Aurora protocol epoch offset (Jan 1, 2000 00:00:00 UTC)
# The Aurora protocol uses a custom epoch instead of Unix epoch (Jan 1, 1970)
# Reference: https://github.com/xreef/ABB_Aurora_Solar_Inverter_Library/blob/master/include/utils.h#L8
# Protocol documentation: https://mischianti.org/wp-content/uploads/2022/01/AuroraCommunicationProtocol_4_2.pdf
AURORA_EPOCH_OFFSET = 946684800
```text

1. **State Mappings** ([const.py:33-37](../../custom_components/abb_fimer_pvi_vsn_rest/const.py#L33-L37)):

```python
# Aurora Protocol State Mappings
# Reference: https://github.com/xreef/ABB_Aurora_Solar_Inverter_Library/blob/master/include/statesNaming.h
# Protocol documentation: https://mischianti.org/wp-content/uploads/2022/01/AuroraCommunicationProtocol_4_2.pdf
# These mappings translate integer state codes to human-readable descriptions
```text

**CLAUDE.md Updates**:

- Added Aurora Protocol Integration section
- Documented timestamp handling with protocol reference
- Added link to both online and local PDF copies

## Technical Improvements

### Code Changes

**[sensor.py:60-97](../../custom_components/abb_fimer_pvi_vsn_rest/sensor.py#L60-L97):**

- Updated `_format_device_name()` function signature
- Changed parameter from `device_sn_compact` to `device_sn_original`
- Updated call site to pass `self._device_id` instead of `self._device_sn_compact`
- Updated docstring with full serial number examples

**[const.py:27-37](../../custom_components/abb_fimer_pvi_vsn_rest/const.py#L27-L37):**

- Added Aurora Communication Protocol PDF references
- Enhanced comments with official documentation links

**[CLAUDE.md](../../CLAUDE.md):**

- Added Aurora protocol documentation section
- Referenced local PDF copy location

## Files Changed

- `custom_components/abb_fimer_pvi_vsn_rest/sensor.py` - Device name serial number fix
- `custom_components/abb_fimer_pvi_vsn_rest/const.py` - Aurora protocol PDF references
- `custom_components/abb_fimer_pvi_vsn_rest/manifest.json` - Version bump to 1.0.0-beta.20
- `docs/AuroraCommunicationProtocol_4_2.pdf` - Added official protocol documentation (NEW)
- `CLAUDE.md` - Documentation updates
- `docs/releases/v1.0.0-beta.20.md` - Release notes (NEW)

## Breaking Changes

None. This release is fully backward compatible with beta.19.

## Upgrade Notes

After upgrading to beta.20:

1. Device names will automatically show full serial numbers
1. No configuration changes required
1. Existing entity unique IDs remain unchanged

## Known Issues

None reported for this release.

## Credits

- Aurora Communication Protocol documentation from [Mischianti.org](https://mischianti.org)
- Aurora protocol integration based on [xreef/ABB_Aurora_Solar_Inverter_Library](https://github.com/xreef/ABB_Aurora_Solar_Inverter_Library)

## Related Releases

- [v1.0.0-beta.19](v1.0.0-beta.19.md) - Comprehensive Entity Improvements & Aurora Protocol Integration
