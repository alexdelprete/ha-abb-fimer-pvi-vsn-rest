# Release Notes - v1.1.15

**Release Date**: 2025-11-23

**Type**: Bug Fix Release

**Focus**: Translation Files Updated for Energy Sensor Display Names

---

## Overview

This release fixes an issue where energy sensor display names were not updating in the Home Assistant UI after the v1.1.14 release. The mapping file had been updated with new display names, but the translation files were not regenerated, causing users to see the old names.

**Key Fix**: Regenerated all 10 translation files to match the mapping file's display names.

---

## Acknowledgments

Thanks to **@ivanfmartinez** for reporting this issue in [Discussion #7](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/discussions/7#discussioncomment-15053980). Their testing helped identify the root cause.

---

## Bug Fixed

### Translation Files Not Updated After Display Name Changes

**Problem**: After v1.1.14 was released with updated energy sensor display names (e.g., "Last 7 Days" → "(Current Week)"), users reported that entity names in Home Assistant UI were not changing.

**Root Cause**:

1. The integration uses `_attr_translation_key` for entity naming
2. Entity display names come from `translations/*.json` files, NOT directly from the mapping file
3. v1.1.14 updated the mapping file and generator script, but failed to regenerate translation files
4. Home Assistant loads entity names from translations, so users saw old names

**Technical Detail**: When `has_entity_name=True` is used with translation keys, Home Assistant looks up entity names in `translations/{language}.json` under `entity.sensor.{key}.name`. The mapping file's `HA Display Name` field is only used to generate these translation entries.

**Fix Applied**:

1. Regenerated mapping files using the updated generator script
2. Updated all 10 translation files with 246 entity translations each
3. Added translation verification step to the release process in CLAUDE.md

**Result**: Entity names now display correctly with the new naming pattern:

| Entity Key | Old Name | New Name |
|------------|----------|----------|
| `week_wh` | "Energy - Last 7 Days" | "Energy - (Current Week)" |
| `month_wh` | "Energy - Last 30 Days" | "Energy - (Current Month)" |
| `year_wh` | "Energy - Last Year" | "Energy - (Current Year)" |
| `day_wh` | "Energy - Today" | "Energy AC - Produced (Today)" |
| `e0_last_week` | "Energy AC - Produced Last 7 Days" | "Energy AC - Produced (Current Week)" |

---

## Technical Details

### Files Modified

**Translation files** (all 10 languages):

- `translations/de.json` (German)
- `translations/en.json` (English)
- `translations/es.json` (Spanish)
- `translations/et.json` (Estonian)
- `translations/fi.json` (Finnish)
- `translations/fr.json` (French)
- `translations/it.json` (Italian)
- `translations/nb.json` (Norwegian Bokmål)
- `translations/pt.json` (Portuguese)
- `translations/sv.json` (Swedish)

**Documentation**:

- `CLAUDE.md`: Added "Step 0: VERIFY TRANSLATIONS" to release process

### Mapping Files Regenerated

The following files were regenerated to ensure consistency:

- `docs/vsn-sunspec-point-mapping.json`
- `docs/vsn-sunspec-point-mapping.xlsx`
- `custom_components/.../abb_fimer_vsn_rest_client/data/vsn-sunspec-point-mapping.json`
- `scripts/vsn-mapping-generator/output/vsn-sunspec-point-mapping.json`
- `scripts/vsn-mapping-generator/output/vsn-sunspec-point-mapping.xlsx`

---

## Process Improvement

To prevent this issue in future releases, a new verification step was added to the release process:

**Step 0: VERIFY TRANSLATIONS** (added to CLAUDE.md):

Before ANY release, ensure translation files match the mapping:

1. Compare `HA Display Name` values in mapping JSON with `translations/en.json`
2. Entity names come from translations, NOT from the mapping file
3. If mapping was updated, translations MUST be regenerated
4. Check all `entity.sensor.{key}.name` entries match mapping's `HA Display Name`

---

## Upgrade Notes

### Breaking Changes

None.

### Action Required

After upgrading to v1.1.15:

1. Reload the integration (Settings → Devices & Services → ABB/FIMER PVI VSN REST → Reload)
2. Entity display names should now show the new naming pattern
3. Entity IDs remain unchanged - no automations or dashboards should break

### If Names Still Don't Update

If entity names don't update after reload:

1. Go to Developer Tools → Statistics
2. Find entities with warnings about renamed sensors
3. Click "Fix issue" to update the statistics database
4. Or: Delete the integration and re-add it (entity history will be preserved if entity IDs match)

---

## Version History

- **v1.1.15** (2025-11-23): Translation files updated for energy sensor names
- **v1.1.14** (2025-11-23): M101/M102 single-phase support + energy display names
- **v1.1.13** (2025-11-23): Log spam prevention during device offline periods
- **v1.1.12** (2025-01-17): Duplicate sensor resolution with VSN name normalization
