# v1.0.0-beta.22 - Entity ID Standardization & Display Name Improvements

**Release Date**: 2025-11-11

## Overview

This release implements major improvements to entity identification and display naming to provide better namespace isolation and enable superior entity grouping in Home Assistant's
UI.

## Highlights

### üîß Entity ID Format Update with Domain Prefix

**Problem**: Entity IDs lacked domain prefixing, making them prone to conflicts with other integrations and lacking clear ownership indication.

**Solution**: Added domain prefix to all entity IDs for namespace isolation.

**Before (beta.21)**:

```text
sensor.inverter_0779093g823112_ac_power
sensor.datalogger_a406e97f4249_wlan0_link_quality
```text

**After (beta.22)**:

```text
sensor.abb_fimer_pvi_vsn_rest_inverter_0779093g823112_ac_power
sensor.abb_fimer_pvi_vsn_rest_datalogger_a406e97f4249_wlan0_link_quality
```text

**Format**: `sensor.{domain}_{device_type}_{serial_compact}_{point_name}`

**Benefits**:

- ‚úÖ Namespace isolation prevents conflicts with other integrations
- ‚úÖ Clear ownership indication
- ‚úÖ Domain dynamically sourced from manifest.json (not hardcoded)

**Files Changed**:

- [sensor.py:230](../../custom_components/abb_fimer_pvi_vsn_rest/sensor.py#L230) - Updated device_identifier to use DOMAIN constant
- [sensor.py:241](../../custom_components/abb_fimer_pvi_vsn_rest/sensor.py#L241) - Updated suggested_object_id to include DOMAIN prefix

### üîë Unique ID Format Alignment

**Problem**: Unique IDs used hardcoded prefix `abb_vsn_rest` instead of the actual domain from manifest.json.

**Solution**: Updated unique IDs to use DOMAIN constant, aligning format with entity IDs.

**Before (beta.21)**:

```text
abb_vsn_rest_inverter_0779093g823112_ac_power
```text

**After (beta.22)**:

```text
abb_fimer_pvi_vsn_rest_inverter_0779093g823112_ac_power
```text

**Format**: `{domain}_{device_type}_{serial_compact}_{point_name}`

**Benefits**:

- ‚úÖ Consistent format between unique_id and entity_id
- ‚úÖ Domain dynamically sourced from manifest.json
- ‚úÖ Proper namespace isolation

### üìä Display Name Standardization (187 Entities)

**Problem**: Display names followed inconsistent patterns, preventing effective grouping by type in Home Assistant's entity lists and UI.

**Solution**: Standardized all entity display names to follow pattern: **[Type] [AC/DC] - [Details] - [Time Period]**

**Examples**:

| Before | After | Improvement | |--------|-------|-------------| | AC Power | Power AC | TYPE-first enables grouping | | DC Voltage #1 | Voltage DC - String 1 | Consistent AC/DC
format | | Inverter AC energy produced - Lifetime | Energy AC - Produced Lifetime | Shorter, clearer | | House consumption from inverter - Last 7 Days | Energy - House from
Inverter Last 7 Days | Concise | | Cabinet Temperature | Temperature - Cabinet | TYPE-first pattern | | Grid Frequency | Frequency AC - Grid | AC designation added |

**Changes by Category**:

- **Energy entities**: 75 changes (40% of total)
- **Power entities**: 24 changes
- **Voltage entities**: 27 changes
- **Current entities**: 19 changes
- **Temperature entities**: 9 changes
- **Frequency entities**: 6 changes
- **Reactive Power entities**: 5 changes
- **Other entities**: 22 changes

**Total**: 187 entities standardized

**Key Benefits**:

- ‚úÖ TYPE-first naming enables perfect grouping in HA UI (all "Energy" entities group together, all "Power" entities group together, etc.)
- ‚úÖ Consistent time period terminology (Lifetime, Since Restart, Last 7 Days, Last 30 Days, Last Year, Today)
- ‚úÖ Clear AC/DC designation where relevant
- ‚úÖ Shorter, more readable names
- ‚úÖ Better hierarchy for related measurements

**Implementation**:

- Added `DISPLAY_NAME_STANDARDIZATION` dictionary in generate_mapping.py with 187 mappings
- Updated `apply_display_name_corrections()` function to apply both corrections and standardization
- Regenerated all mapping files (Excel and JSON)

**Files Changed**:

- [generate_mapping.py:396-600](../../scripts/vsn-mapping-generator/generate_mapping.py#L396-L600) - Added DISPLAY_NAME_STANDARDIZATION dictionary
- [generate_mapping.py:2061-2079](../../scripts/vsn-mapping-generator/generate_mapping.py#L2061-L2079) - Updated apply function
- [vsn-sunspec-point-mapping.json](../../custom_components/abb_fimer_pvi_vsn_rest/data/vsn-sunspec-point-mapping.json) - Regenerated with all standardizations

## Technical Details

### Entity ID Generation

The new entity ID format uses three components from manifest.json and runtime data:

```python
# sensor.py
device_identifier = f"{DOMAIN}_{device_type_simple}_{device_sn_compact}"
unique_id = f"{device_identifier}_{point_name}"
suggested_object_id = f"{DOMAIN}_{device_type_simple}_{device_sn_compact}_{point_name}"
```text

### Display Name Standardization Pattern

The standardization follows a strict pattern for optimal grouping:

```text
[Type] [AC/DC] - [Details] - [Time Period]
```text

- **Type**: Energy, Power, Voltage, Current, Frequency, Temperature, Resistance, Count, Speed, etc.
- **AC/DC**: Included only when relevant for electrical measurements
- **Details**: Descriptive information (Phase A, String 1, Battery, Grid, etc.)
- **Time Period**: Lifetime, Since Restart, Last 7 Days, Last 30 Days, Last Year, Today (omitted if not applicable)

### Mapping File Regeneration

All mapping fixes required regenerating the mapping files:

1. Updated `generate_mapping.py` with DISPLAY_NAME_STANDARDIZATION dictionary
1. Ran `python generate_mapping.py` to create Excel
1. Ran `python convert_to_json.py` to create JSON
1. JSON automatically copied to integration data folder

## Breaking Changes

‚ö†Ô∏è **IMPORTANT**: This release contains breaking changes for existing beta users.

### Entity IDs Will Change

All entity IDs will change due to the addition of the domain prefix. Example:

- **Old**: `sensor.inverter_0779093g823112_ac_power`
- **New**: `sensor.abb_fimer_pvi_vsn_rest_inverter_0779093g823112_ac_power`

### Unique IDs Will Change

All unique IDs will change from `abb_vsn_rest_*` prefix to `abb_fimer_pvi_vsn_rest_*` prefix.

### Why These Changes Are Necessary

1. **Namespace Isolation**: Prevents potential conflicts with other integrations
1. **Clarity**: Makes it immediately obvious which integration owns each entity
1. **Consistency**: Aligns unique_id and entity_id formats
1. **Future-Proofing**: Uses domain from manifest.json instead of hardcoded values

## Upgrade Notes

### For New Installations

No special steps required. Simply install beta.22 and configure the integration.

### For Existing Beta Users

After upgrading to beta.22, you **MUST** perform entity registry cleanup:

1. **Delete the integration** in Home Assistant (Settings ‚Üí Devices & Services ‚Üí ABB/FIMER PVI VSN REST ‚Üí 3-dot menu ‚Üí Delete)

1. **Stop Home Assistant**

1. **Edit `.storage/core.entity_registry`**:

   - Find all entries with `"platform": "abb_fimer_pvi_vsn_rest"`
   - Delete those entire entity objects from the JSON array
   - Save the file ensuring valid JSON format

1. **Start Home Assistant**

1. **Re-add the integration**

1. **Verify** the new entity ID format:

   - Entity IDs should start with `sensor.abb_fimer_pvi_vsn_rest_`
   - Display names should follow TYPE-first pattern (e.g., "Power AC", "Energy AC - Produced Lifetime")

### Why Manual Cleanup Is Required

Home Assistant persists entity IDs in the registry and restores them when an integration is reloaded, even if the unique_id changes. Manual cleanup ensures a clean slate with the
new format.

### What You'll Lose

- **Entity history**: Previous entity history will not be transferred to the new entity IDs
- **Automations/Scripts**: Any automations or scripts referencing old entity IDs will need to be updated

### What Will Be Preserved

- **Device information**: Device data remains intact
- **Configuration**: Integration configuration is preserved

## Files Changed

### Integration Core Files

- `custom_components/abb_fimer_pvi_vsn_rest/sensor.py` - Entity ID and unique ID format updates
- `custom_components/abb_fimer_pvi_vsn_rest/manifest.json` - Version bump to 1.0.0-beta.22
- `custom_components/abb_fimer_pvi_vsn_rest/const.py` - VERSION constant update

### Mapping Generator Files

- `scripts/vsn-mapping-generator/generate_mapping.py` - DISPLAY_NAME_STANDARDIZATION dictionary and apply function
- `custom_components/abb_fimer_pvi_vsn_rest/data/vsn-sunspec-point-mapping.json` - Regenerated with all changes
- `scripts/vsn-mapping-generator/output/vsn-sunspec-point-mapping.json` - Regenerated
- `scripts/vsn-mapping-generator/output/vsn-sunspec-point-mapping.xlsx` - Regenerated

### Documentation

- `docs/releases/v1.0.0-beta.22.md` - Release notes (NEW)
- `CHANGELOG.md` - Updated with beta.22 summary

## Examples

### Power Entities

- AC Power ‚Üí **Power AC**
- DC Power ‚Üí **Power DC**
- House Power A ‚Üí **Power AC - House Phase A**
- String 1 Power ‚Üí **Power DC - String 1**
- Battery Discharge Power ‚Üí **Power - Battery Discharge**

### Energy Entities

- AC Energy ‚Üí **Energy AC - Lifetime**
- Inverter AC energy produced - Since Restart ‚Üí **Energy AC - Produced Since Restart**
- House consumption from inverter - Last 7 Days ‚Üí **Energy - House from Inverter Last 7 Days**
- Energy exported to grid - Lifetime ‚Üí **Energy AC - Grid Export Lifetime**

### Voltage/Current/Frequency Entities

- AC Voltage A-N ‚Üí **Voltage AC - Phase A-N**
- AC Current ‚Üí **Current AC**
- Grid Frequency ‚Üí **Frequency AC - Grid**
- DC Voltage #1 ‚Üí **Voltage DC - String 1**

### Temperature Entities

- Cabinet Temperature ‚Üí **Temperature - Cabinet**
- Inverter Temperature ‚Üí **Temperature - Inverter**
- Battery Temperature ‚Üí **Temperature - Battery**

## Known Issues

None reported for this release.

## Migration from Pre-Beta.20 Versions

If you're upgrading from versions before beta.20, you may also have serial number truncation issues. The entity registry cleanup described above will resolve both the domain prefix
changes and any legacy truncation issues.

## Credits

ü§ñ Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>

## Related Releases

- [v1.0.0-beta.21](v1.0.0-beta.21.md) - Entity Display Fixes & Icon Support
- [v1.0.0-beta.20](v1.0.0-beta.20.md) - Device Name Fix & Aurora Protocol Documentation
- [v1.0.0-beta.19](v1.0.0-beta.19.md) - Comprehensive Entity Improvements & Aurora Protocol Integration
