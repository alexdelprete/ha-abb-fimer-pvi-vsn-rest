# Release Notes - v1.1.14

**Release Date**: 2025-11-23

**Type**: Feature Release

**Focus**: M101/M102 Single-Phase Inverter Support + Energy Display Name Improvements

______________________________________________________________________

## Overview

This release adds support for single-phase (M101) and split-phase (M102) inverters, and improves energy sensor display names for better clarity. Previously, only three-phase (M103)
inverters were fully supported, causing missing sensors for users with single-phase systems.

**Key Improvements**:

- Full support for single-phase inverters (e.g., PVI-4.2-OUTD, PVI-3.0-OUTD)
- Runtime normalization leverages SunSpec model equivalence (M101/M102/M103 have identical points)
- Zero mapping file changes needed - smart solution with ~15 lines of code
- Improved energy display names with clearer time period naming

______________________________________________________________________

## Acknowledgments

Special thanks to **@SidShetye** for reporting [Issue #14](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues/14) and providing test data from their PVI-4.2-OUTD
single-phase inverter. This data was invaluable in identifying the M101 support gap and validating the fix.

______________________________________________________________________

## Features Added

### Feature #1: M101/M102 Single-Phase Inverter Support

**Problem**: Users with single-phase inverters (M101) like the PVI-4.2-OUTD were experiencing missing sensors. The integration only mapped three-phase (M103) point names, but
VSN300 prefixes points with the model number (e.g., `m101_1_W` instead of `m103_1_W`).

**Affected Inverters**:

- All single-phase models (M101): PVI-3.0-OUTD, PVI-4.2-OUTD, PVI-5.0-OUTD, etc.
- All split-phase models (M102): Various US market inverters

**Solution**: Runtime pattern normalization in the data normalizer. SunSpec defines M101 (single-phase), M102 (split-phase), and M103 (three-phase) with **identical point
definitions** - only the phase count differs. The fix normalizes M101/M102 prefixes to M103 for consistent mapping lookup.

**Implementation**:

```python
# normalizer.py - New method added
def _normalize_vsn300_point_name(self, point_name: str) -> str:
    """Normalize M101/M102 prefixes to M103 for mapping lookup."""
    if point_name.startswith(("m101_", "m102_")):
        return "m103_" + point_name[5:]
    return point_name
```text

**Result**:

- All 253 mapped sensors now work for single-phase inverters
- No duplicate mapping entries needed
- Temperature correction also works for M101 cabinet temperature

### Feature #2: Improved Energy Display Names

**Change**: Updated time period naming pattern for energy sensors to be more intuitive.

| Old Pattern | New Pattern | |-------------|-------------| | "Last 7 Days" | "(Current Week)" | | "Last 30 Days" | "(Current Month)" | | "Last Year" | "(Current Year)" | | N/A |
"(Today)" |

**Examples**:

- "Energy AC - Produced Last 7 Days" → "Energy AC - Produced (Current Week)"
- "Energy - Battery Charge Last 30 Days" → "Energy - Battery Charge (Current Month)"
- "Energy - Today" → "Energy AC - Produced (Today)"

**Rationale**: The new pattern is clearer - "Current Week" implies a rolling 7-day window, while "Last 7 Days" could be ambiguous. The parentheses also provide visual separation
between the sensor type and time period.

______________________________________________________________________

## Technical Details

### Files Modified

**normalizer.py**:

- Added `_normalize_vsn300_point_name()` method for M101/M102 → M103 conversion
- Added `m101_1_TmpCab` to `TEMP_CORRECTION_POINTS` for single-phase cabinet temperature
- Updated `normalize()` method to use normalization before mapping lookup

**generate_mapping.py**:

- Updated `DISPLAY_NAME_STANDARDIZATION` dictionary with new time period patterns
- Updated `VSN700_POINT_IMPROVEMENTS` for DayWH and self-consumed energy entries

**Generated files** (automatically regenerated):

- `vsn-sunspec-point-mapping.json` (both copies)
- `vsn-sunspec-point-mapping.xlsx`

### How M101 Normalization Works

```text
VSN300 Single-Phase Inverter (M101)
         │
         ▼
   Raw point: "m101_1_W"
         │
         ▼
   Normalize: "m103_1_W"
         │
         ▼
   Mapping lookup finds M103 entry
         │
         ▼
   Sensor created with correct metadata
```text

### VSN700 Compatibility

VSN700 uses phase-agnostic proprietary names (e.g., `Pgrid`, `Igrid`) regardless of inverter phase type. No changes were needed for VSN700 - the same mapping works for all phase
configurations.

______________________________________________________________________

## Breaking Changes

**None** - This is a feature release with no breaking changes. Existing sensors continue to work exactly as before.

______________________________________________________________________

## Migration Notes

**For Users with Single-Phase Inverters**:

- After upgrading, previously missing sensors will automatically appear
- No manual configuration needed
- If you had workarounds for missing sensors, you can now remove them

**For All Users**:

- Energy sensor display names will update automatically
- Entity IDs remain unchanged (based on internal point names)
- Only the user-facing display names change

______________________________________________________________________

## Upgrade Priority

**RECOMMENDED for single-phase users** - This release fixes missing sensors for M101 inverters.

**Optional for three-phase users** - Only display name improvements, no functional changes.

______________________________________________________________________

## Related Issues

- [Issue #14](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues/14) - Lifetime Energy [kWh] is missing in HA (reported by @SidShetye)

______________________________________________________________________

## Full Changelog

See [CHANGELOG.md](../../CHANGELOG.md) for the complete changelog.
