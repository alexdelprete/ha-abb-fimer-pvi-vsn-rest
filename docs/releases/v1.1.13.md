# Release Notes - v1.1.13

**Release Date**: 2025-11-23

**Type**: Bug Fix Release

**Focus**: Fix log spam during device offline periods

---

## Overview

This release fixes excessive logging during device offline periods, such as when the inverter is offline at night (no solar power). Previously, the integration would log WARNING/ERROR messages every poll interval, resulting in 800+ log entries overnight.

**Key Improvements**:

- Removed redundant manual logging from coordinator and setup
- Now follows [HA Integration Quality Scale: log-when-unavailable](https://developers.home-assistant.io/docs/core/integration-quality-scale/rules/log-when-unavailable/)
- DataUpdateCoordinator handles logging automatically with built-in spam prevention

---

## Bug Fixed

### Bug #1: Log Spam During Connection Failures

**Problem**: When the inverter is offline (e.g., nighttime when there's no solar power), the integration logged WARNING and ERROR messages every poll interval (default: 60 seconds).

**Symptoms**:

```
13:55:56 - (ERROR) ABB/FIMER PVI VSN REST - message first occurred at 08:51:23 and shows up 4 times
Error fetching abb_fimer_pvi_vsn_rest data: Connection error: Timeout connecting to abb-vsn300.axel.dom:80

13:55:56 - (WARNING) ABB/FIMER PVI VSN REST - message first occurred at 22 November 2025 at 16:54:05 and shows up 803 times
Connection error: Timeout connecting to abb-vsn300.axel.dom:80
```

**Root Cause**: The integration had redundant manual logging in addition to Home Assistant's built-in DataUpdateCoordinator logging. Every connection failure produced TWO log entries:

1. **WARNING** from manual `_LOGGER.warning()` call (repeated every poll)
2. **ERROR** from HA's DataUpdateCoordinator (automatic)

**Fix**: Removed all redundant manual logging. The `UpdateFailed` exception and `ConfigEntryNotReady` exception already trigger HA's built-in logging with spam prevention.

**Result**:

- ✅ Coordinator logs ONCE when device goes offline
- ✅ No repeated logging during overnight offline periods
- ✅ Coordinator logs ONCE when device comes back online
- ✅ Follows Home Assistant Integration Quality Scale best practices

---

## Technical Details

### Files Modified

**coordinator.py** (lines 84-98):

Removed redundant logging before `UpdateFailed`:

```python
# Before (WRONG - causes double logging)
except VSNConnectionError as err:
    _LOGGER.warning("Connection error: %s", err)  # ← REMOVED
    raise UpdateFailed(f"Connection error: {err}") from err

# After (CORRECT - coordinator handles logging)
except VSNConnectionError as err:
    raise UpdateFailed(f"Connection error: {err}") from err
```

**__init__.py** (lines 104-106, 130-132):

Removed redundant logging before `ConfigEntryNotReady`:

```python
# Before (WRONG - HA handles this)
except Exception as err:
    _LOGGER.error("Discovery failed during setup: %s", err)  # ← REMOVED
    raise ConfigEntryNotReady(f"Discovery failed: {err}") from err

# After (CORRECT - HA handles logging)
except Exception as err:
    raise ConfigEntryNotReady(f"Discovery failed: {err}") from err
```

### How HA Handles Logging

**DataUpdateCoordinator** ([source](https://github.com/home-assistant/core/blob/dev/homeassistant/helpers/update_coordinator.py)):

- Tracks `last_update_success` state
- Only logs when state changes (success → failure, failure → success)
- Built-in spam prevention - no repeated logging on subsequent failures

**ConfigEntryNotReady** ([docs](https://developers.home-assistant.io/docs/integration_setup_failures)):

- HA logs at DEBUG level automatically
- Message appears in UI on integrations page
- Automatic retry without user intervention

---

## Breaking Changes

**None** - This is a bug fix release with no breaking changes.

---

## Migration Notes

**For Users**:

- No action required - log spam will stop automatically after upgrade
- Existing functionality unchanged
- Connection failures still handled correctly (sensors become unavailable)

---

## Upgrade Priority

**RECOMMENDED - Upgrade When Convenient**

Benefits:

- Cleaner logs without overnight spam
- Follows Home Assistant best practices
- No functional changes

Impact: None - purely a logging improvement

---

## Related Documentation

- [HA Integration Quality Scale: log-when-unavailable](https://developers.home-assistant.io/docs/core/integration-quality-scale/rules/log-when-unavailable/)
- [HA Integration Setup Failures](https://developers.home-assistant.io/docs/integration_setup_failures)
- [DataUpdateCoordinator Source](https://github.com/home-assistant/core/blob/dev/homeassistant/helpers/update_coordinator.py)

---

## Full Changelog

See [CHANGELOG.md](../../CHANGELOG.md) for the complete changelog.
