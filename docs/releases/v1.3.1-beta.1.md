# Release Notes - v1.3.1-beta.1

## Overview

This beta release focuses on improving test coverage to 97%, matching the quality standards of our other integrations (ha-sinapsi-alfa, ha-4noks-elios4you).

## Test Coverage Improvements

### Coverage Statistics

- **Overall coverage**: 95% → **97%**
- **sensor.py coverage**: 86% → **97%**
- **Total tests**: 416 tests passing

### New Test Classes Added

#### sensor.py Tests

- **TestAsyncSetupEntry**: Tests for the `async_setup_entry` platform function
  - `test_setup_entry_no_data`: Early return when no coordinator data
  - `test_setup_entry_with_devices`: Sensor creation for devices
  - `test_setup_entry_datalogger_first`: Datalogger sensors added before inverter sensors

- **TestVSNSensorNativeValueEdgeCases**: Edge case tests for `native_value` property
  - `test_native_value_no_coordinator_data`: None return on missing data
  - `test_native_value_device_not_found`: Device not in devices dict
  - `test_native_value_point_not_found`: Point not in points dict
  - `test_native_value_sys_time_exception`: Exception handling in sys_time conversion
  - `test_native_value_system_load_rounding`: 2 decimal rounding
  - `test_native_value_count_sensors_rounded_to_int`: Integer conversion for count sensors
  - `test_native_value_state_sensors_rounded_to_int`: Integer conversion for state sensors

- **TestVSNSensorAvailableEdgeCases**: Additional availability property tests

- **TestVSNSensorStateMapping**: State code translation tests
  - `test_state_mapping_unknown_code`: Unknown code returns "Unknown (code)"
  - `test_state_mapping_known_code`: Known code returns translated string

- **TestVSNSensorDeviceInfoEdgeCases**: Device info edge cases
  - `test_device_info_datalogger_with_hostname`: configuration_url for datalogger
  - `test_device_info_inverter_via_device`: via_device for inverter
  - `test_device_info_no_discovered_device`: Defaults when device not found

#### mapping_loader.py Tests

- **test_fetch_from_github_success**: Tests successful GitHub fallback download

### Bug Fixes in Tests

- Fixed async context manager mock patterns for HTTP error tests
- Fixed `PropertyMock` usage for mocking sensor's `hass` property
- Added missing `sunspec_name` field for state mapping tests
- Added missing `status_data` argument to `MockDiscoveryResult` calls

## Installation

### HACS (Recommended)

1. Open HACS in Home Assistant
2. Go to Integrations
3. Search for "ABB/FIMER PVI VSN REST"
4. Install the integration
5. Restart Home Assistant

### Manual Installation

1. Download the latest release
2. Copy the `custom_components/abb_fimer_pvi_vsn_rest` folder to your Home Assistant config
3. Restart Home Assistant

## Beta Testing

This is a beta release. Please report any issues at:
https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues

## Full Changelog

See [CHANGELOG.md](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/blob/master/CHANGELOG.md) for complete history.
