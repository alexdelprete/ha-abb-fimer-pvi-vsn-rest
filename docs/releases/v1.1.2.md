# Release v1.1.2 - REACT2 Support & Authentication Improvements

**Release Date**: 2025-11-15

**Type**: Feature Release (Authentication Enhancements)

**Focus**: Add REACT2 inverter support and improve VSN700 authentication logic

---

## Overview

This release adds support for REACT2 inverters and improves the VSN authentication detection logic. REACT2 devices use VSN700 dataloggers with preemptive Basic authentication but don't send WWW-Authenticate headers in the same way as standard VSN700 devices. The integration now handles this correctly.

---

## What's New

### ‚ú® Feature: REACT2 Inverter Support

**Problem**: REACT2 inverters (e.g., REACT2-5.0-TL) were failing authentication with error:
```
Device returned 401 but no WWW-Authenticate header found
```

**Root Cause**: REACT2 devices use VSN700 dataloggers internally, but require preemptive Basic authentication without sending the standard WWW-Authenticate header.

**Solution**:
- Enhanced detection logic to try preemptive Basic authentication when VSN300 is ruled out
- REACT2 devices now correctly detected as VSN700-compatible
- Added comprehensive debug logging for authentication diagnostics

**User Impact**:
- ‚úÖ REACT2 inverters now fully supported
- ‚úÖ No configuration changes needed - automatic detection
- ‚úÖ Works with existing VSN700 credentials

**Commits**:
- [ae4d617](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/ae4d617) - Initial REACT2 support
- [dd6661d](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/dd6661d) - Refactored detection logic
- [fc845cd](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/fc845cd) - Simplified VSN700 detection

---

### üîß Improvement: Simplified Authentication Detection

**Before**:
```python
if not www_authenticate:
    # Special case for missing header
elif "x-digest" in www_authenticate:
    # VSN300
elif "basic" in www_authenticate:
    # VSN700
else:
    # Unknown
```

**After**:
```python
if "x-digest" in www_authenticate:
    # VSN300 - return immediately
else:
    # Try preemptive Basic auth (VSN700/REACT2)
```

**Benefits**:
- Simpler, more maintainable code
- Unified code path for VSN700 and REACT2
- Removed 21 lines of redundant code
- Better performance (same request count)

**Commit**: [dd6661d](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/dd6661d)

---

### üìù Improvement: Authentication Debug Logging

Added comprehensive debug logging throughout the authentication flow to help users diagnose connection issues:

**VSN Detection**:
```
[VSN Detection] Making unauthenticated request to https://192.168.1.100/v1/status
[VSN Detection] Response received: status=401, headers={...}
[VSN Detection] WWW-Authenticate header (raw): NOT PRESENT
[VSN Detection] Not VSN300. Attempting preemptive Basic authentication for VSN700.
[VSN Detection] Preemptive auth response: status=200, headers={...}
[VSN Detection] Detected VSN700 (preemptive Basic authentication)
```

**VSN300 Digest Auth**:
```
[VSN300 Auth] Requesting digest challenge: method=GET, url=/v1/livedata
[VSN300 Auth] Challenge response: status=401, headers={...}
[VSN300 Auth] Parsed challenge params: realm=FIMER, nonce=..., qop=auth
```

**Client Requests**:
```
[Client] Using VSN700 basic authentication
[Client] Fetching livedata: url=https://..., auth=Basic, timeout=10s
[Client] Response: status=200, headers={...}
```

**To Enable**: Add to `configuration.yaml`:
```yaml
logger:
  logs:
    custom_components.abb_fimer_pvi_vsn_rest: debug
```

**Commit**: [e2bd91c](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/e2bd91c)

---

### üìö Improvement: Complete Translation Quality

Fixed translation quality issues in all 9 non-English languages. Previously, many sensors had mixed English/native language names.

**Before**:
```
"connection": "Connection"           ‚ùå (English)
"battery": "Battery"                 ‚ùå (English)
"model": "Model identifier"          ‚ùå (Mixed)
```

**After**:
```
"connection": "Verbindung"           ‚úÖ (German)
"battery": "Batterie"                ‚úÖ (German)
"model": "Modellkennung"             ‚úÖ (German)
```

**Languages Fixed**:
- üá´üá∑ French (`fr`) - 251 sensors
- üá™üá∏ Spanish (`es`) - 251 sensors
- üáµüáπ Portuguese (`pt`) - 251 sensors
- üá©üá™ German (`de`) - 251 sensors
- üá∏üá™ Swedish (`sv`) - 251 sensors
- üá≥üá¥ Norwegian (`nb`) - 251 sensors
- üá´üáÆ Finnish (`fi`) - 251 sensors
- üá™üá™ Estonian (`et`) - 251 sensors
- üáÆüáπ Italian (`it`) - 251 sensors

**Total**: 2,259 sensor translations (251 √ó 9 languages) now complete and professional

**Commit**: [e3001df](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/e3001df)

---

### üìñ Improvement: Updated Documentation

Updated README.md with accurate authentication flow documentation:

**New "VSN Authentication" Section**:
- Detection process explained step-by-step
- VSN300 digest authentication details
- VSN700 preemptive Basic authentication details
- Automatic detection - no user configuration needed

**Commit**: (this release)

---

## Technical Details

### Authentication Flow Changes

**Detection Sequence**:
1. Send unauthenticated `GET /v1/status`
2. Receive `401` response
3. Check for `X-Digest` header:
   - **Found** ‚Üí VSN300 (return immediately)
   - **Not found** ‚Üí Try preemptive Basic auth
     - **Success (200/204)** ‚Üí VSN700
     - **Failure** ‚Üí Error (unsupported device)

**VSN300 Authentication**:
- Custom X-Digest scheme
- Challenge-response flow
- MD5 digest: `MD5(MD5(username:realm:password):nonce:MD5(method:uri))`
- Fresh challenge required per request

**VSN700/REACT2 Authentication**:
- Preemptive HTTP Basic
- `Authorization: Basic {base64(username:password)}`
- No challenge required
- Same credentials reused for all requests

---

## Migration Guide

### ‚ö†Ô∏è NO BREAKING CHANGES

This release **does not** require any migration:

- ‚úÖ No entity ID changes
- ‚úÖ No configuration changes
- ‚úÖ No entity registry cleanup needed

Simply upgrade to v1.1.2 and restart Home Assistant.

### Upgrade Steps

1. **Update via HACS** (recommended):
   - Open HACS ‚Üí Integrations
   - Find "ABB FIMER PVI VSN REST"
   - Click "Update" or "Redownload"
   - Restart Home Assistant

2. **Update Manually**:
   - Download v1.1.2 from [GitHub Releases](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/releases/tag/v1.1.2)
   - Copy `custom_components/abb_fimer_pvi_vsn_rest` to your HA config directory
   - Restart Home Assistant

---

## For REACT2 Users

If you previously had authentication failures with REACT2 inverters:

1. **Remove old integration entry** (if it failed to set up):
   - Settings ‚Üí Devices & Services
   - Find failed ABB FIMER integration
   - Click "..." ‚Üí "Delete"

2. **Add integration again**:
   - Click "+ Add Integration"
   - Search "ABB FIMER PVI VSN REST"
   - Enter your REACT2 datalogger IP and credentials
   - **Should now work!** ‚úÖ

3. **Enable debug logging** (optional, for verification):
   ```yaml
   logger:
     logs:
       custom_components.abb_fimer_pvi_vsn_rest: debug
   ```

4. **Check logs** for:
   ```
   [VSN Detection] Detected VSN700 (preemptive Basic authentication)
   ```

---

## Compatibility

- **Home Assistant**: 2024.1.0 or later
- **Python**: 3.11 or later
- **VSN Dataloggers**: VSN300, VSN700
- **Inverters**: ABB, FIMER, Power-One PVI series, **REACT2 series** ‚ú® NEW

---

## Full Changelog

### Enhancements
- feat: Add REACT2 support via preemptive Basic authentication ([ae4d617](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/ae4d617))
- feat: Add comprehensive debug logging for authentication diagnostics ([e2bd91c](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/e2bd91c))
- refactor: Try preemptive Basic auth immediately after ruling out VSN300 ([dd6661d](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/dd6661d))
- refactor: Remove artificial VSN700/REACT2 distinction in detection logging ([fc845cd](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/fc845cd))

### Translations
- fix: Complete and improve all 9 language translations ([e3001df](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/e3001df))
  - Fixed 2,259 sensor translations (251 √ó 9 languages)
  - Professional electrical/solar terminology
  - No more mixed English/native text

### Documentation
- docs: Update README.md with accurate VSN authentication flow
- docs: Add detailed authentication detection process
- docs: Explain VSN300 digest vs VSN700 Basic auth differences

See [CHANGELOG.md](../../CHANGELOG.md) for complete version history.

---

## Known Issues

None - all known issues have been resolved.

---

## Support

### Getting Help

- **Questions**: [GitHub Discussions](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/discussions)
- **Bug Reports**: [GitHub Issues](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues)
- **Feature Requests**: [GitHub Issues](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues)

### Contributing

Contributions are welcome! Areas where help is appreciated:

- Testing with REACT2 inverters
- Language translations
- Testing with different inverter models
- Documentation improvements
- Bug reports and fixes

---

## Acknowledgments

- **Bug Reports**: User with REACT2-5.0-TL inverter (issue reported via maintainer)
- **Development**: Claude Code (AI Assistant)
- **Project Maintainer**: @alexdelprete

---

## Support Development

If you find this integration useful, consider supporting development:

[![Buy Me a Coffee](https://img.shields.io/badge/Buy%20Me%20a%20Coffee-donate-yellow.svg?style=flat-square)](https://www.buymeacoffee.com/alexdelprete)

---

ü§ñ This release was generated with [Claude Code](https://claude.com/claude-code)
