# Release v1.0.0-beta.24

**Release Date**: 2025-11-12

**Type**: Critical Bug Fix Release

**Focus**: Fix entity ID generation broken in beta.13

______________________________________________________________________

## Overview

This release fixes a critical bug introduced in beta.13 where `has_entity_name` was incorrectly changed from `False` to `True`, breaking the `suggested_object_id` mechanism that
controls entity ID generation.

______________________________________________________________________

## Critical Bug Fix

### üêõ Entity ID Generation Fixed

**Problem**: Since beta.13 (October 31, 2025), entity IDs were not following the intended format. Instead of:

```text
sensor.abb_fimer_pvi_vsn_rest_inverter_0779093g823112_ac_power
```text

Users were seeing:

```text
sensor.power_one_inverter_pvi_10_0_outd_077909_3g82_3112_ac_power
sensor.abb_fimer_datalogger_vsn300_111033_3n16_1421_available_ram
```text

**Root Cause**:

- In beta.13, `has_entity_name` was changed from `False` to `True`
- When `has_entity_name=True`, Home Assistant **ignores** `suggested_object_id` and generates entity_id from `device_name + entity_name`
- This caused entity IDs to include device model names, non-compacted serial numbers with underscores, and inconsistent prefixes

**Fix**:

- Reverted `has_entity_name` back to `False` (line 210 in sensor.py)
- Corrected misleading comments that incorrectly documented how `has_entity_name=True` behaves with `suggested_object_id`

**Result** (after fix):

- ‚úÖ Entity IDs now use the correct format: `sensor.abb_fimer_pvi_vsn_rest_{device_type}_{serial_compact}_{point_name}`
- ‚úÖ Friendly display names remain unchanged: "System Load Average", "AC Power", etc.
- ‚úÖ Device names remain friendly: "ABB Datalogger VSN300 (111033-3N16-1421)"
- ‚úÖ Unique IDs and entity IDs now have consistent format

______________________________________________________________________

## Technical Details

### Changes Made

**1. sensor.py line 210**

```python
# FROM (broken since beta.13):
self._attr_has_entity_name = True

# TO (fixed):
self._attr_has_entity_name = False
```text

**2. sensor.py lines 248-251 - Corrected Documentation**

```python
# FROM (incorrect documentation):
# With has_entity_name=True, HA will auto-construct:
#   entity_id = slugify(device_name + " " + suggested_object_id) (controlled by suggested_object_id)
#   friendly_name = device_name + " " + entity_name (friendly display)

# TO (correct documentation):
# With has_entity_name=False, HA uses suggested_object_id directly:
#   entity_id = sensor.{suggested_object_id}
#   friendly_name = {_attr_name} (friendly display from mapping)
```text

### How Entity Naming Works

**With `has_entity_name=False` (CORRECT - beta.24)**:

- `suggested_object_id` controls entity_id directly
- Entity ID: `sensor.{suggested_object_id}`
- Friendly name: Value from `_attr_name` (e.g., "AC Power")
- Device name: Friendly format (e.g., "ABB Datalogger VSN300 (111033-3N16-1421)")

**With `has_entity_name=True` (BROKEN - beta.13-23)**:

- `suggested_object_id` is **ignored**
- Entity ID: `sensor.{slugify(device_name + " " + entity_name)}`
- This produces unpredictable entity IDs based on device naming

### Commits Included

1. `[hash]` - fix: revert has_entity_name to False to fix entity ID generation
1. `[hash]` - chore(release): bump version to v1.0.0-beta.24

______________________________________________________________________

## Migration Guide

### ‚ö†Ô∏è BREAKING CHANGE - Manual Migration Required

**All entity IDs will change again.** This is necessary to fix the broken behavior from beta.13-23.

**Before (beta.23 - BROKEN)**:

```text
sensor.abb_fimer_datalogger_vsn300_111033_3n16_1421_system_load_average
```text

**After (beta.24 - FIXED)**:

```text
sensor.abb_fimer_pvi_vsn_rest_datalogger_1110333n161421_system_load_average
```text

### Migration Steps

1. **Delete the integration**:

   - Settings ‚Üí Devices & Services
   - Find "ABB/FIMER PVI VSN REST"
   - Click the three dots ‚Üí Delete

1. **Clean entity registry** (CRITICAL):

   ```bash
   # Stop Home Assistant
   # Edit .storage/core.entity_registry
   # Remove all entries with platform: "abb_fimer_pvi_vsn_rest"
   # Start Home Assistant
   ```

1. **Restart Home Assistant**

1. **Re-add the integration**:

   - Settings ‚Üí Devices & Services ‚Üí Add Integration
   - Search for "ABB/FIMER PVI VSN REST"
   - Configure with your VSN datalogger details

1. **Update dashboards and automations** with new entity IDs

### Apology

We sincerely apologize for this back-and-forth with entity ID changes. The bug was introduced in beta.13 and went undetected until users reported the issue. This fix restores the
correct behavior from beta.12.

______________________________________________________________________

## Compatibility

- **Home Assistant**: 2024.1.0 or later
- **Python**: 3.11 or later
- **VSN Dataloggers**: VSN300, VSN700
- **Inverters**: ABB, FIMER, Power-One PVI series

______________________________________________________________________

## Known Issues

None - This release specifically fixes the entity ID generation issue.

______________________________________________________________________

## What's Next

### Planned for v1.0.0-beta.25+

- Continue bug fixes and improvements based on user feedback
- Move towards stable v1.0.0 release once beta testing is complete

______________________________________________________________________

## Full Changelog

See [CHANGELOG.md](../../CHANGELOG.md) for complete version history.

______________________________________________________________________

## Contributors

- **Bug Report**: @alexdelprete (maintainer)
- **Development**: Claude Code (AI Assistant)
- **Project Maintainer**: @alexdelprete

______________________________________________________________________

## References

- **Bug introduced**: v1.0.0-beta.13 (commit `2885524`, October 31, 2025)
- **Last working version**: v1.0.0-beta.12 (commit `04c73d8`, October 29, 2025)
- **Fixed in**: v1.0.0-beta.24 (this release)

______________________________________________________________________

ü§ñ This release was generated with [Claude Code](https://claude.com/claude-code)
