# Release v1.1.1 - Bug Fixes

**Release Date**: 2025-11-15

**Type**: Patch Release (Bug Fixes)

**Focus**: Fix CI/CD and runtime errors

---

## Overview

This patch release fixes two critical issues discovered after v1.1.0:

1. **GitHub Actions CI failure** - Ruff was checking vendor directory
2. **Home Assistant runtime error** - AttributeError when creating sensors

Both issues are now resolved and the integration works correctly.

---

## Bug Fixes

### üêõ Fix #1: GitHub Actions Ruff Check Failure

**Problem**: The GitHub Actions lint workflow was failing because ruff was trying to format and check the `vendor/` directory containing third-party SunSpec model code.

**Root Cause**: The [.ruff.toml](../../.ruff.toml) file was missing an `exclude` configuration. Ruff's default exclusions don't include `vendor/` directories.

**Solution**:

- Added `extend-exclude` configuration to [.ruff.toml](../../.ruff.toml)
- Excluded: `vendor/`, `.vscode/`, `.devcontainer/`, `.github/`
- Applied automatic formatting fixes to 3 files

**Files Changed**:

- [.ruff.toml:3-9](../../.ruff.toml#L3-L9) - Added exclusion configuration
- [client.py](../../custom_components/abb_fimer_pvi_vsn_rest/abb_fimer_vsn_rest_client/client.py) - Multi-line formatting
- [normalizer.py](../../custom_components/abb_fimer_pvi_vsn_rest/abb_fimer_vsn_rest_client/normalizer.py) - Comment alignment
- [sensor.py](../../custom_components/abb_fimer_pvi_vsn_rest/sensor.py) - Multi-line formatting

**Commit**: [5d0e292](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/5d0e292)

---

### üêõ Fix #2: AttributeError at Sensor Creation

**Problem**: Home Assistant failed to load the integration with this error:

```
AttributeError: 'VSNSensor' object has no attribute '_attr_name'
```

**Root Cause**: When implementing the translation system in v1.1.0, we switched to using `_attr_translation_key` with `has_entity_name=True`. This made `_attr_name` unnecessary, but we forgot to update two debug log statements that referenced it.

**Solution**:

- Replaced `self._attr_name` with `self._point_name` in debug logs (lines 261, 350)
- Added `translation_key` to debug output for better diagnostics

**Why This Works**: With `has_entity_name=True` (set on line 210), Home Assistant uses `_attr_translation_key` to look up entity names from the translation files. The `_attr_name` attribute is not needed in this pattern.

**Files Changed**:

- [sensor.py:259-265](../../custom_components/abb_fimer_pvi_vsn_rest/sensor.py#L259-L265) - First debug log fix
- [sensor.py:348-357](../../custom_components/abb_fimer_pvi_vsn_rest/sensor.py#L348-L357) - Second debug log fix

**Commit**: [dafba7d](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/commit/dafba7d)

---

## Notes

### Version String Correction

‚ö†Ô∏è **Important**: v1.1.0 was released with incorrect version strings in [manifest.json](../../custom_components/abb_fimer_pvi_vsn_rest/manifest.json) and [const.py](../../custom_components/abb_fimer_pvi_vsn_rest/const.py) (still showing "1.0.0"). This has been corrected in v1.1.1.

If you're using v1.1.0, please update to v1.1.1 to get:

- Correct version strings in files
- CI/CD fixes
- Runtime error fixes

---

## Migration Guide

### ‚ö†Ô∏è NO BREAKING CHANGES

This release **does not** require any migration:

- ‚úÖ No entity ID changes
- ‚úÖ No configuration changes
- ‚úÖ No entity registry cleanup needed

Simply upgrade to v1.1.1 and restart Home Assistant.

### Upgrade Steps

1. **Update via HACS** (recommended):
   - Open HACS ‚Üí Integrations
   - Find "ABB FIMER PVI VSN REST"
   - Click "Update" or "Redownload"
   - Restart Home Assistant

2. **Update Manually**:
   - Download v1.1.1 from [GitHub Releases](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/releases/tag/v1.1.1)
   - Copy `custom_components/abb_fimer_pvi_vsn_rest` to your HA config directory
   - Restart Home Assistant

---

## Compatibility

- **Home Assistant**: 2024.1.0 or later
- **Python**: 3.11 or later
- **VSN Dataloggers**: VSN300, VSN700
- **Inverters**: ABB, FIMER, Power-One PVI series

---

## What's Included in v1.1.1

### From v1.1.0 (Multi-Language Support)

If you're upgrading from v1.0.0, you also get all the features from v1.1.0:

- üåç **10 Language Support**: EN, IT, FR, ES, PT, DE, SV, NB, FI, ET
- üî§ **251 Translated Sensors**: Professional electrical/solar terminology
- üèóÔ∏è **Architecture Improvement**: Mapping file moved to client library
- üìù **30+ Documentation Fixes**: MD032 markdown linting

See [v1.1.0 Release Notes](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/releases/tag/v1.1.0) for full details.

### From v1.0.0 (First Stable Release)

If you're upgrading from a beta version, you also get:

- üì¶ **Production-Ready**: All critical bugs resolved
- üîß **258 Data Points**: Comprehensive coverage
- üåê **Multi-Device Support**: Inverters, meters, batteries
- üîç **Auto Discovery**: VSN model and device detection
- üé® **Beautiful UI**: Friendly device names, modern entity naming

See [v1.0.0 Release Notes](./v1.0.0.md) for full details.

---

## Full Changelog

See [CHANGELOG.md](../../CHANGELOG.md) for complete version history.

---

## Known Issues

None - all known issues from v1.1.0 have been fixed.

---

## Support

### Getting Help

- **Questions**: [GitHub Discussions](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/discussions)
- **Bug Reports**: [GitHub Issues](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues)
- **Feature Requests**: [GitHub Issues](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues)

### Contributing

Contributions are welcome! Areas where help is appreciated:

- Language translations
- Testing with different inverter models
- Documentation improvements
- Bug reports and fixes

---

## Acknowledgments

- **Bug Reports**: @alexdelprete (maintainer)
- **Development**: Claude Code (AI Assistant)
- **Project Maintainer**: @alexdelprete

---

## Support Development

If you find this integration useful, consider supporting development:

[![Buy Me a Coffee](https://img.shields.io/badge/Buy%20Me%20a%20Coffee-donate-yellow.svg?style=flat-square)](https://www.buymeacoffee.com/alexdelprete)

---

ü§ñ This release was generated with [Claude Code](https://claude.com/claude-code)
