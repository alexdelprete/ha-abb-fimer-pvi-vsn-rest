# Release Notes - v1.3.0

**Release Date**: 2025-12-06

**Focus**: Custom Device Name Prefixes

______________________________________________________________________

## Overview

This release adds the ability to customize device names for each device type (inverter, datalogger, meter, battery) through the integration options. This feature was requested by
the community to allow users to set friendly, personalized names for their devices.

Thanks to **@ivanfmartinez** for the feature request in [Issue #19](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues/19).

______________________________________________________________________

## New Features

### Custom Device Name Prefixes

Configure custom names for each device type in the integration Options:

| Setting | Device Name | Entity ID Example | |---------|-------------|-------------------| | **No prefix (default)** | `Power-One Inverter PVI-10.0-OUTD (077909-3G82-3112)` |
`sensor.power_one_inverter_pvi_...` | | **Custom: "My Inverter"** | `My Inverter` | `sensor.my_inverter_power_ac` |

**Key Features**:

- **Per-device-type prefixes**: Set different names for inverter, datalogger, meter, and battery devices
- **Dynamic options form**: Only shows prefix fields for device types that were actually discovered
- **Safe by default**: Entity IDs are preserved when changing device names (automations keep working)
- **Optional entity ID regeneration**: Checkbox to update entity IDs to match new device names (with warning)

### Dynamic Options Form

The options form dynamically shows only the prefix fields relevant to your setup:

| Your Setup | Fields Shown | |------------|--------------| | VSN300 with inverter only | Inverter name, Datalogger name | | VSN700 with REACT2 (inverter + battery + meter) | All 4
device name fields |

### Multi-Language Support

Options flow UI is translated into 9 languages:

- German (DE), Spanish (ES), Estonian (ET), Finnish (FI), French (FR)
- Italian (IT), Norwegian Bokmål (NB), Portuguese (PT), Swedish (SV)

______________________________________________________________________

## Bug Fixes

### "Unknown Error" on First Options Submit

Fixed a confusing error message when saving configuration options.

**Problem**: When submitting configuration changes, an "Unknown error" appeared on first submit, but changes were actually saved correctly.

**Root Cause**: The `async_reload_entry` function was incorrectly defined as a sync function but Home Assistant's `add_update_listener` expects an async coroutine.

**Fix**: Changed function signature from sync to async.

______________________________________________________________________

## How to Use

1. Go to **Settings → Devices & Services → ABB/FIMER PVI VSN REST**
1. Click **Configure** on your integration entry
1. Enter custom names for any device type you want to customize
1. Leave fields empty to keep default naming
1. (Optional) Check "Regenerate entity IDs" if you want entity IDs to match new names

**Warning**: The "Regenerate entity IDs" option will break existing automations, scripts, and dashboards that reference these entities. Only use this if you understand the
implications.

______________________________________________________________________

## Technical Details

### Files Modified

| File | Changes | |------|---------| | `const.py` | Added 5 new config constants for prefixes | | `config_flow.py` | Dynamic options form + entity ID regeneration | | `sensor.py`
| Custom prefix support in `_format_device_name()` | | `__init__.py` | Fixed async_reload_entry to be async | | `translations/*.json` | Added options UI strings for 10 languages |

### New Config Constants

```python
CONF_PREFIX_INVERTER = "prefix_inverter"
CONF_PREFIX_DATALOGGER = "prefix_datalogger"
CONF_PREFIX_METER = "prefix_meter"
CONF_PREFIX_BATTERY = "prefix_battery"
CONF_REGENERATE_ENTITY_IDS = "regenerate_entity_ids"  # One-time action
```text

______________________________________________________________________

## Upgrade Notes

This is a non-breaking feature release. Simply update to the latest version.

**For existing users**: Your current device names and entity IDs will remain unchanged until you configure custom prefixes in the options.

______________________________________________________________________

## Related Issues

- Implements [Issue #19](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues/19) - Feature request by @ivanfmartinez for custom device name prefixes
