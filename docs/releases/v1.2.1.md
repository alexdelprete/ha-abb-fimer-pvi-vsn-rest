# Release Notes - v1.2.1

**Release Date**: 2025-12-04

**Type**: Bug Fix Release

**Focus**: Support for Devices Without Authentication + Translation Script Consolidation

---

## Overview

This release fixes an issue where VSN devices with authentication disabled could not be configured. Previously, the detection logic expected a 401 (Unauthorized) response to determine the device model. Now it also handles 200 (OK) responses by analyzing the status data structure.

Thanks to **@wannabuy** for reporting this issue in [Issue #25](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues/25).

---

## Bug Fixes

### Support for Devices Without Authentication (HTTP 200 Response)

**Problem**: Users with VSN devices that have authentication disabled could not complete integration setup. The error message was:

```text
Client error: Expected 401 response for detection, got 200
```

**Root Cause**: The `detect_vsn_model()` function in `auth.py` only handled HTTP 401 responses for model detection via WWW-Authenticate header analysis. When a device returns HTTP 200 (no authentication required), detection failed.

**Fix Applied**: Added fallback detection when HTTP 200 is received:

1. Parse the status JSON response
2. Analyze data structure to determine VSN model:

| Indicator | VSN300 | VSN700 |
|-----------|--------|--------|
| `keys.logger.board_model` | = "WIFI LOGGER CARD" | (not present) |
| `keys.logger.sn` | Serial format: `XXXXXX-XXXX-XXXX` | (not present) |
| `keys.logger.loggerId` | (not present) | MAC format: `xx:xx:xx:xx:xx:xx` |
| Number of keys | Many (>10) | Few (≤3) |

**Files Modified**:

- `custom_components/.../abb_fimer_vsn_rest_client/auth.py`
  - Updated `detect_vsn_model()` to handle HTTP 200 responses
  - Added new helper function `_detect_model_from_status()`

---

## Refactoring

### Translation Scripts Consolidation

Consolidated 9 duplicate translation generator scripts into a unified modular structure.

**Problem**: The original scripts (`generate_complete_*.py`) had 96-97% code duplication:

- 9 separate scripts (~265 lines each = ~2,385 lines total)
- Only the translation dictionary differed between scripts

**Solution**: Created modular structure:

```text
scripts/generate-translations/
├── __init__.py
├── generate_translations.py          # Unified CLI (~150 lines)
└── translation_dictionaries/
    ├── __init__.py
    ├── de.py, es.py, et.py, fi.py, fr.py, it.py, nb.py, pt.py, sv.py
```

**Usage**:

```bash
# Generate all languages
python scripts/generate-translations/generate_translations.py --all

# Generate single language
python scripts/generate-translations/generate_translations.py --language de

# List available languages
python scripts/generate-translations/generate_translations.py --list
```

**Benefits**:

- **85% code reduction**: ~2,385 lines → ~350 lines
- **Single source of truth**: One translation logic file
- **Easy language additions**: Just add a dictionary file

---

## Dependencies Updated

- `ruff`: 0.14.6 → 0.14.7
- `actions/checkout`: 6.0.0 → 6.0.1
- `actions/setup-python`: 6.0.0 → 6.1.0
- `softprops/action-gh-release`: 2.4.2 → 2.5.0

---

## Documentation

- Updated CLAUDE.md with translation script paths
- Added translation script architecture section to TRANSLATION_REPORT.md
- Added DEV_NOTES.md entry for translation consolidation

---

## Full Changelog

- fix: handle devices without authentication (HTTP 200 response)
- fix: resolve ruff lint errors in translation scripts
- refactor: consolidate translation scripts into modular structure
- docs: update documentation for translation script consolidation
- chore(deps): Bump ruff from 0.14.6 to 0.14.7
- chore(deps): Bump actions/checkout from 6.0.0 to 6.0.1
- chore(deps): Bump actions/setup-python from 6.0.0 to 6.1.0
- chore(deps): Bump softprops/action-gh-release from 2.4.2 to 2.5.0

---

## Upgrade Notes

This is a non-breaking bug fix release. Simply update to the latest version.

**For users with unauthenticated VSN devices**: You can now complete the integration setup. Simply add the integration and enter your device's IP address.
