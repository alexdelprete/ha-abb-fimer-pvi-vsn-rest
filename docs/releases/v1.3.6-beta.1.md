# Release Notes - v1.3.6-beta.1

[![GitHub Downloads](https://img.shields.io/github/downloads/alexdelprete/ha-abb-fimer-pvi-vsn-rest/v1.3.6-beta.1/total?style=for-the-badge)](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/releases/tag/v1.3.6-beta.1)

**Release Date**: 2026-02-17

**Focus**: Per-Device Custom Name Prefixes for Multi-Device Setups (Fixes #36)

______________________________________________________________________

## Overview

This beta introduces per-device custom name prefixes, solving the problem where users
with multiple devices of the same type (e.g., 2 batteries, 2 inverters) could not
rename them individually. Previously, a single prefix field per device type meant all
devices of that type shared the same name, causing entity ID collisions.

Thanks to **@ferotap** for reporting [issue #36](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/issues/36).

______________________________________________________________________

## What's Changed

### Per-Device Custom Name Prefixes

When multiple devices of the same type are discovered, the options flow now shows
indexed fields instead of a single shared field:

**Before (single field per type)**:

- "Battery device name" - applied to ALL batteries

**After (indexed fields)**:

- "Battery 1 device name" - applied to first battery only
- "Battery 2 device name" - applied to second battery only

**Key details**:

- Single device per type: unchanged behavior (backward compatible)
- Multiple devices per type: indexed fields (`prefix_battery_1`, `prefix_battery_2`, etc.)
- Devices sorted by `device_id` within each type for stable, deterministic ordering
- Supports up to 4 devices per type in translations
- Entity ID regeneration updated to use per-device prefix lookup

### `strings.json` as Canonical English Source

Following Home Assistant convention, `strings.json` is now the canonical English source
file. The translation generator reads from `strings.json` and syncs it to
`translations/en.json`.

### Full Translation Coverage

All indexed prefix strings are fully translated in all 9 languages:
de, es, et, fi, fr, it, nb, pt, sv.

Each language has complete translations for both the field labels (e.g., "Battery 1
device name") and field descriptions (e.g., "Custom name for Battery 1. Leave empty
for default.").

### Code Cleanup

- Added `TYPE_TO_CONF_PREFIX` shared mapping in `const.py`
- Removed backward-compatible aliases (`_compact_serial_number`, `_format_device_name`)
  from `sensor.py`; uses direct imports from `helpers.py`

______________________________________________________________________

## Backward Compatibility

- **Single-device-per-type systems**: Zero changes - same keys, same behavior
- **Existing multi-device systems**: Old `prefix_battery` value is not used for
  multi-device types. Users need to set names in the new indexed fields.

______________________________________________________________________

## Testing Focus

This beta needs testing from users with:

1. **Multiple devices of the same type** (e.g., 2 batteries, 2 inverters)
   - Verify indexed prefix fields appear in options
   - Verify each device gets its own custom name
   - Verify entity IDs are unique and correct
2. **Single device per type** (most users)
   - Verify no changes to existing behavior
   - Verify prefix fields work as before

______________________________________________________________________

## Technical Details

### Files Modified

| File | Changes |
|------|---------|
| `const.py` | Added `TYPE_TO_CONF_PREFIX` shared mapping |
| `config_flow.py` | Options form builds indexed fields dynamically; `_regenerate_entity_ids()` uses per-device prefix lookup |
| `sensor.py` | Added `_get_device_type_simple()`, `_get_prefix_key_for_device()` helpers; removed aliases |
| `strings.json` | New canonical English source file |
| `translations/*.json` | All 10 languages updated with indexed prefix strings |
| `generate_translations.py` | Reads from `strings.json`, syncs to `en.json` |
| `translation_dictionaries/*.py` | All 9 language dictionaries updated with indexed prefix entries |

**Full Changelog**: [v1.3.5...v1.3.6-beta.1](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/compare/v1.3.5...v1.3.6-beta.1)
