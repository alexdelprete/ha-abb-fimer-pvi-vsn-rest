# Release v1.0.0-beta.26

**Release Date**: 2025-11-12

**Type**: Bug Fix + Enhancement Release

**Focus**: Fix system_uptime ValueError + Beautiful UI with friendly device names

---

## Overview

This release fixes two critical issues:

1. **system_uptime sensor failing to load** with ValueError due to returning formatted string instead of numeric value
2. **Ugly device names and friendly names** from beta.25's technical device name approach

Beta.26 provides the best of both worlds: numeric values with formatted attributes for uptime, and beautiful friendly device names throughout the UI.

---

## Bug Fixes

### üêõ system_uptime Sensor ValueError

**Problem**: The `system_uptime` sensor was failing to load with this error:

```
ValueError: Sensor sensor.abb_fimer_datalogger_vsn300_111033_3n16_1421_system_uptime
has device class 'duration', state class 'total_increasing' unit 's'
and suggested precision '0' thus indicating it has a numeric value;
however, it has the non-numeric value: '10 hours 9 minutes' (<class 'str'>)
```

**Root Cause**:
- The sensor was configured with:
  - `device_class: duration` (expects numeric)
  - `state_class: total_increasing` (expects numeric)
  - `unit: s` (seconds - numeric)
- But the code was returning a formatted string: `"10 hours 9 minutes"`
- Home Assistant rejected the sensor because of this mismatch

**Solution**:
- Return raw numeric value (seconds) as `native_value` ‚Üí satisfies HA's requirements
- Add `formatted` attribute with human-readable string ‚Üí beautiful display in Lovelace

**Code Changes** ([sensor.py:446-448](d:\OSILifeDrive\Dev\HASS\ha-abb-fimer-pvi-vsn-rest\custom_components\abb_fimer_pvi_vsn_rest\sensor.py#L446-L448)):
```python
# REMOVED (was causing ValueError):
if self._point_name == "system_uptime" and isinstance(value, (int, float)):
    return self._format_uptime_seconds(value)

# NOW: Just return raw numeric value
return value
```

**Added attribute** ([sensor.py:511-515](d:\OSILifeDrive\Dev\HASS\ha-abb-fimer-pvi-vsn-rest\custom_components\abb_fimer_pvi_vsn_rest\sensor.py#L511-L515)):
```python
# Add formatted uptime for system_uptime sensor (native_value is numeric seconds)
if self._point_name == "system_uptime":
    raw_value = point_data.get("value")
    if isinstance(raw_value, (int, float)):
        attributes["formatted"] = self._format_uptime_seconds(raw_value)
```

**Result**:
- ‚úÖ Native value: `36600` (numeric seconds)
- ‚úÖ Statistics and history work properly
- ‚úÖ Formatted attribute: `"10 hours 9 minutes"`
- ‚úÖ Users can display beautifully in Lovelace: `{{ state_attr('sensor.system_uptime', 'formatted') }}`

---

### üé® Beautiful Device Names and Friendly Names

**Problem (Beta.25)**:
- Device names were ugly technical format: `abb_fimer_pvi_vsn_rest_datalogger_1110333n161421`
- Entity friendly names were ugly: `abb_fimer_pvi_vsn_rest_datalogger_1110333n161421 Firmware Version`
- Made the entire UI unpleasant to use

**Solution (Beta.26)**:
- Use friendly device names: `ABB Datalogger VSN300 (111033-3N16-1421)`
- Entity friendly names now beautiful: `ABB Datalogger VSN300 (111033-3N16-1421) Firmware Version`
- Follows Home Assistant best practices for modern integrations

**Code Change** ([sensor.py:552-557](d:\OSILifeDrive\Dev\HASS\ha-abb-fimer-pvi-vsn-rest\custom_components\abb_fimer_pvi_vsn_rest\sensor.py#L552-L557)):
```python
# FROM (beta.25 - ugly):
device_name = f"{DOMAIN}_{self._device_type_simple}_{self._device_sn_compact}"

# TO (beta.26 - beautiful):
device_name = _format_device_name(
    manufacturer=manufacturer,
    device_type_simple=self._device_type_simple,
    device_model=device_model,
    device_sn_original=self._device_id,
)
```

**Impact on Entity IDs**:

Entity IDs will change because device names are slugified by Home Assistant:

**Datalogger Example**:
- **Before (beta.25)**: `sensor.abb_fimer_pvi_vsn_rest_datalogger_1110333n161421_firmware_version`
- **After (beta.26)**: `sensor.abb_datalogger_vsn300_111033_3n16_1421_firmware_version`

**Inverter Example**:
- **Before (beta.25)**: `sensor.abb_fimer_pvi_vsn_rest_inverter_0779093g823112_power_peak_lifetime`
- **After (beta.26)**: `sensor.power_one_inverter_pvi_10_0_outd_077909_3g82_3112_power_peak_lifetime`

**What You Gain**:
- ‚úÖ Beautiful device names throughout UI
- ‚úÖ Beautiful entity friendly names
- ‚úÖ Still technical entity IDs (contain manufacturer, model, serial)
- ‚úÖ Follows HA best practices

**What You Lose**:
- ‚ùå Domain prefix `abb_fimer_pvi_vsn_rest_` in entity IDs
- ‚ùå Fully compacted serial `1110333n161421` ‚Üí `111033_3n16_1421`

---

## Technical Details

### File Changes Summary

| File | Lines | Change |
|------|-------|--------|
| sensor.py | 446-448 | Removed uptime formatting from native_value |
| sensor.py | 511-515 | Added formatted attribute for system_uptime |
| sensor.py | 552-557 | Changed to friendly device names |
| manifest.json | 13 | Version bump to 1.0.0-beta.26 |
| const.py | 4 | Version bump to 1.0.0-beta.26 |

### Before & After Comparison

#### Datalogger Device

**Beta.25** (Ugly):
```
Device Name: "abb_fimer_pvi_vsn_rest_datalogger_1110333n161421"
Entity ID: sensor.abb_fimer_pvi_vsn_rest_datalogger_1110333n161421_system_uptime
Friendly Name: "abb_fimer_pvi_vsn_rest_datalogger_1110333n161421 System Uptime"
Native Value: "10 hours 9 minutes" (ValueError! ‚ùå)
```

**Beta.26** (Beautiful):
```
Device Name: "ABB Datalogger VSN300 (111033-3N16-1421)"
Entity ID: sensor.abb_datalogger_vsn300_111033_3n16_1421_system_uptime
Friendly Name: "ABB Datalogger VSN300 (111033-3N16-1421) System Uptime"
Native Value: 36600 (numeric seconds ‚úÖ)
Formatted Attribute: "10 hours 9 minutes" ‚úÖ
```

#### Inverter Device

**Beta.25** (Ugly):
```
Device Name: "abb_fimer_pvi_vsn_rest_inverter_0779093g823112"
Entity ID: sensor.abb_fimer_pvi_vsn_rest_inverter_0779093g823112_ac_power
Friendly Name: "abb_fimer_pvi_vsn_rest_inverter_0779093g823112 AC Power"
```

**Beta.26** (Beautiful):
```
Device Name: "Power-One Inverter PVI-10.0-OUTD (077909-3G82-3112)"
Entity ID: sensor.power_one_inverter_pvi_10_0_outd_077909_3g82_3112_ac_power
Friendly Name: "Power-One Inverter PVI-10.0-OUTD (077909-3G82-3112) AC Power"
```

---

## Migration Guide

### ‚ö†Ô∏è BREAKING CHANGE - Manual Migration Required

**All entity IDs will change.** This is necessary to fix the ValueError bug and provide beautiful UI.

### Migration Options

#### Option 1: Use "Recreate Entity IDs" Feature (Recommended)

Home Assistant provides a built-in feature to recreate entity IDs while preserving entity registry entries:

1. **Upgrade to beta.26**
2. **Restart Home Assistant**
3. **Open each device page**:
   - Settings ‚Üí Devices & Services ‚Üí ABB/FIMER PVI VSN REST
   - Click on each device (datalogger, inverters)
4. **Use "Recreate Entity IDs" button** (if available in your HA version)
5. **Update dashboards and automations** with new entity IDs

#### Option 2: Delete and Reinstall

If "Recreate Entity IDs" is not available:

1. **Delete the integration**:
   - Settings ‚Üí Devices & Services
   - Find "ABB/FIMER PVI VSN REST"
   - Click three dots ‚Üí Delete
   - This automatically removes all entities from registry

2. **Restart Home Assistant**

3. **Re-add the integration**:
   - Settings ‚Üí Devices & Services ‚Üí Add Integration
   - Search for "ABB/FIMER PVI VSN REST"
   - Configure with your VSN datalogger details

4. **Update dashboards and automations** with new entity IDs

### Using the Formatted Uptime Attribute

**In Lovelace Cards**:
```yaml
type: entity
entity: sensor.abb_datalogger_vsn300_111033_3n16_1421_system_uptime
attribute: formatted  # Shows "10 hours 9 minutes"
```

**In Templates**:
```yaml
{{ state_attr('sensor.abb_datalogger_vsn300_111033_3n16_1421_system_uptime', 'formatted') }}
```

**Native Value (for automations/statistics)**:
```yaml
{{ states('sensor.abb_datalogger_vsn300_111033_3n16_1421_system_uptime') | int }}
# Returns: 36600 (seconds)
```

---

## Compatibility

- **Home Assistant**: 2024.1.0 or later
- **Python**: 3.11 or later
- **VSN Dataloggers**: VSN300, VSN700
- **Inverters**: ABB, FIMER, Power-One PVI series

---

## Known Issues

None - This release fixes the critical bugs from beta.25.

---

## What's Next

### Planned for v1.0.0-beta.27+

- Continue bug fixes and improvements based on user feedback
- Move towards stable v1.0.0 release once beta testing is complete
- **This is the FINAL entity ID format** - no more changes after beta.26

---

## Full Changelog

See [CHANGELOG.md](../../CHANGELOG.md) for complete version history.

---

## Contributors

- **Bug Reports & Testing**: @alexdelprete (maintainer)
- **Development**: Claude Code (AI Assistant)
- **Project Maintainer**: @alexdelprete

---

## References

- **system_uptime bug introduced**: v1.0.0-beta.13 (October 31, 2025)
- **Entity naming issue from**: v1.0.0-beta.25 (November 12, 2025)
- **Fixed in**: v1.0.0-beta.26 (this release)

---

ü§ñ This release was generated with [Claude Code](https://claude.com/claude-code)
