# Release Notes - v1.2.0

**Release Date**: 2025-11-23

**Type**: Breaking Change Release

**Focus**: Fix Incorrect Entity IDs for "Since Restart" Energy Sensors

---

## Overview

This release fixes a long-standing bug where 15 energy sensors that track "since restart" values were incorrectly named with `_lifetime` suffix in their entity IDs. The VSN700 REST API uses `_runtime` suffix for these sensors, which means "since device restart", not "lifetime".

**Key Fix**: Changed entity ID suffix from `_lifetime` to `_since_restart` for 15 sensors to accurately reflect their data source.

---

## Breaking Changes

### 15 Entity IDs Renamed

The following entity IDs have changed. **Users must update automations, dashboards, and scripts that reference these entities.**

| Old Entity ID | New Entity ID |
|---------------|---------------|
| `*_e0_lifetime` | `*_e0_since_restart` |
| `*_e1_lifetime` | `*_e1_since_restart` |
| `*_e2_lifetime` | `*_e2_since_restart` |
| `*_e3_lifetime` | `*_e3_since_restart` |
| `*_e4_lifetime` | `*_e4_since_restart` |
| `*_e5_lifetime` | `*_e5_since_restart` |
| `*_e6_lifetime` | `*_e6_since_restart` |
| `*_e7_lifetime` | `*_e7_since_restart` |
| `*_e8_lifetime` | `*_e8_since_restart` |
| `*_e15_lifetime` | `*_e15_since_restart` |
| `*_ein_lifetime` | `*_ein_since_restart` |
| `*_e_charge_lifetime` | `*_e_charge_since_restart` |
| `*_e_discharge_lifetime` | `*_e_discharge_since_restart` |
| `*_e_tot_charge_lifetime` | `*_e_tot_charge_since_restart` |
| `*_e_tot_discharge_lifetime` | `*_e_tot_discharge_since_restart` |

---

## Bug Fixed

### Incorrect Entity IDs for "Since Restart" Sensors

**Problem**: 15 energy sensors were incorrectly named with `_lifetime` suffix when they actually track energy accumulated "since restart" (device power-on/reset).

**Root Cause**: In `generate_mapping.py` line 2689, the `period_map` dictionary incorrectly mapped:

```python
"runtime": "Lifetime",  # WRONG - should be "Since Restart"
```

The VSN700 REST API uses suffixes like `E0_runtime`, `E1_runtime`, etc. which mean "since device restart", not "lifetime". The actual lifetime sensors have different names like `ETotal`, `ETotalAbsorbed`, etc.

**Evidence from VSN700 API data**:

| Sensor Type | Runtime Value | Lifetime Value | Ratio |
|-------------|---------------|----------------|-------|
| AC Produced | `E0_runtime`: 32,821 Wh | `ETotal`: 13,341,652 Wh | 406x |
| AC Apparent | `E2_runtime`: 32,830 VAh | `ETotalApparent`: 13,350,977 VAh | 406x |
| Grid Export | `E3_runtime`: 19,029 Wh | `EGridExport`: 5,773,382 Wh | 303x |

The runtime values are ~400x smaller than lifetime values, confirming they reset when the device restarts.

**Fix Applied**:

```python
"runtime": "Since Restart",  # v1.2.0: Fixed
```

---

## Additional Display Name Fixes

### E2 Series (Apparent Energy)

Changed format from `Energy AC Apparent - (X)` to `Energy AC - Apparent (X)` for consistency:

- "Energy AC - Apparent (Since Restart)"
- "Energy AC - Apparent (Current Week)"
- "Energy AC - Apparent (Current Month)"
- "Energy AC - Apparent (Lifetime)"

### Other Display Name Corrections

| Entity | Old Display Name | New Display Name |
|--------|------------------|------------------|
| `ein1` | "DC energy (String 1) - Lifetime" | "Energy DC - String 1 (Lifetime)" |
| `ein2` | "DC energy (String 2) - Lifetime" | "Energy DC - String 2 (Lifetime)" |
| `power_peak_today` | "Power - Peak Today" | "Power - Peak (Today)" |
| `watthours` | "Energy AC - Lifetime" | "Energy AC - Produced (Lifetime)" |

---

## Technical Details

### Files Modified

**Generator Script**:

- `scripts/vsn-mapping-generator/generate_mapping.py`
  - Line 2689: Fixed `period_map` from "Lifetime" to "Since Restart"
  - Updated `DISPLAY_NAME_STANDARDIZATION` dictionary for consistent naming

**Mapping Files** (regenerated):

- `scripts/vsn-mapping-generator/output/vsn-sunspec-point-mapping.xlsx`
- `scripts/vsn-mapping-generator/output/vsn-sunspec-point-mapping.json`
- `custom_components/.../data/vsn-sunspec-point-mapping.json`

**Translation Files** (all 10 languages regenerated):

- `translations/de.json`, `en.json`, `es.json`, `et.json`, `fi.json`
- `translations/fr.json`, `it.json`, `nb.json`, `pt.json`, `sv.json`

**Version Files**:

- `manifest.json`: Version 1.1.15 → 1.2.0
- `const.py`: VERSION = "1.2.0"

---

## Upgrade Notes

### Migration Steps

1. **Before upgrading**: Note which automations/dashboards use the affected entity IDs
2. **Upgrade** the integration to v1.2.0
3. **Reload** the integration (Settings → Devices & Services → ABB/FIMER PVI VSN REST → Reload)
4. **Update** automations and dashboards to use new entity IDs
5. **Clean up** old entities in Developer Tools → Statistics if needed

### Finding Affected Automations

Search your configuration for these patterns:

```yaml
# Old patterns to find and replace:
_e0_lifetime → _e0_since_restart
_e1_lifetime → _e1_since_restart
_e2_lifetime → _e2_since_restart
# ... etc for all 15 sensors
```

### Entity History

Entity history will NOT be preserved because the entity IDs are changing. The new `_since_restart` entities will start fresh. If you need historical data, export it before upgrading.

---

## Version History

- **v1.2.0** (2025-11-23): Fix incorrect entity IDs for "Since Restart" sensors (BREAKING CHANGE)
- **v1.1.15** (2025-11-23): Translation files updated for energy sensor names
- **v1.1.14** (2025-11-23): M101/M102 single-phase support + energy display names
- **v1.1.13** (2025-11-23): Log spam prevention during device offline periods
- **v1.1.12** (2025-01-17): Duplicate sensor resolution with VSN name normalization
