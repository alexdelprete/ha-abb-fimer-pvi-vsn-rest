# Release Notes - v1.3.4

[![GitHub Downloads](https://img.shields.io/github/downloads/alexdelprete/ha-abb-fimer-pvi-vsn-rest/v1.3.4/total?style=for-the-badge)](https://github.com/alexdelprete/ha-abb-fimer-pvi-vsn-rest/releases/tag/v1.3.4)

**Release Date**: 2026-02-16

**Focus**: Datalogger Device Registry Bug Fixes

______________________________________________________________________

## Overview

This release fixes three bugs related to the datalogger device registration in
Home Assistant, all originating from the same root cause in `async_update_device_registry()`.

______________________________________________________________________

## What's Changed

### Datalogger Device Name Not Updating via Options Flow

When users set a custom device name for the datalogger via the integration options,
the name was ignored. The inverter device name updated correctly, but the datalogger
kept its hardcoded technical name. This is now fixed - custom prefixes work for all
device types.

### Wrong Manufacturer in Device Info

The datalogger's Device Info page showed "by WIFI LOGGER CARD" as the manufacturer.
This was caused by using the board model (`logger_model`) as the manufacturer field.
Now correctly shows "ABB" (for VSN300) or "FIMER" (for VSN700).

### Ugly Default Device Name

The default datalogger device name was a technical internal string like
`abb_fimer_pvi_vsn_rest_datalogger_1110333n161421`. Now uses the friendly format
matching the inverter pattern: "ABB Datalogger VSN300 (111033-3N16-1421)".

______________________________________________________________________

## Root Cause

All three bugs originated from `async_update_device_registry()` in `__init__.py`,
which registered the datalogger device with:

- `manufacturer` set to `logger_model` ("WIFI LOGGER CARD") instead of the actual
  manufacturer from the `DiscoveredDevice` ("ABB")
- `name` hardcoded as `{DOMAIN}_datalogger_{compact_serial}` instead of using the
  shared `format_device_name()` helper that supports custom prefixes

Since this function ran after the sensor platform setup, it overwrote the correct
values that sensors had already set via their `device_info` property.

______________________________________________________________________

## Impact on Existing Users

This is a **non-breaking** change:

- **Entity IDs**: Unchanged (stored in entity registry, stable once created)
- **Automations**: Not affected (use entity_id or device_id, both stable)
- **Device display name**: Updates to friendly format on next reload
- **Manufacturer**: Corrects to "ABB"/"FIMER" on next reload
- **Friendly names**: Improve readability (e.g., "ABB Datalogger VSN300 ... Firmware Version")

Users who manually renamed the device via HA UI keep their custom name.

______________________________________________________________________

## Technical Details

### Files Modified

| File | Changes |
|------|---------|
| `helpers.py` | Added shared `format_device_name()` and `compact_serial_number()` |
| `__init__.py` | Fixed `async_update_device_registry()` to use correct metadata |
| `sensor.py` | Imports helpers from shared module, backward-compatible aliases |
| `tests/test_init.py` | Updated fixtures and assertions for correct values |

### Refactoring

Moved `format_device_name()` and `compact_serial_number()` from `sensor.py` to
`helpers.py` so both `__init__.py` and `sensor.py` can share the same logic.
Backward-compatible aliases ensure existing test imports continue to work.

______________________________________________________________________

## Upgrade Notes

This is a non-breaking change. Simply update the integration through HACS or manually.

No configuration changes are required. The datalogger device info will automatically
correct itself on the next integration reload.
