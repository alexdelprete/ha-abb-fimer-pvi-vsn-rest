# Release v1.0.0-beta.23

**Release Date**: 2025-11-12

**Type**: Developer/Tooling Release

**Focus**: Code quality improvements and developer tooling

---

## Overview

This release focuses on developer tooling improvements with no changes to integration functionality. All changes are in the mapping generator scripts, improving code quality, maintainability, and compliance with Python best practices.

---

## What's New

### Developer Tools & Code Quality

#### üîß Linting Compliance (All 22 Errors Fixed)

Fixed all ruff linting errors in the VSN mapping generator scripts, achieving 100% compliance with Python best practices.

**Categories Fixed:**

1. **Package Structure (1 error)**
   - `INP001`: Added `__init__.py` to `scripts/vsn-mapping-generator/`

2. **Performance Issues (9 errors)**
   - `PERF403`: Use dict comprehension instead of for-loop
   - `PERF102` + `B007`: Replace `.items()` with `.values()` in 6 locations where keys were unused
   - `RUF005`: Use iterable unpacking (`*MODEL_FLAGS`) for cleaner list construction

3. **Code Style (5 errors)**
   - `RET504`: Inline return statements in 4 locations
   - `RET505`: Replace `elif` with `if` after return statements

4. **Data Correctness (1 error)**
   - `F601`: Removed duplicate `"VBulk"` dictionary key

5. **Dead Code (1 error)**
   - `F841`: Removed unused `header_key` variable

6. **Code Complexity (1 error)**
   - `C901`: Refactored complex function (see below)

**Files Fixed:**

- `scripts/vsn-mapping-generator/__init__.py` (created)
- `scripts/vsn-mapping-generator/extract_manual_changes.py` (1 fix)
- `scripts/vsn-mapping-generator/generate_mapping.py` (20 fixes)

#### üèóÔ∏è Code Refactoring

**Reduced Complexity of `generate_mapping_excel_complete()`**

Refactored monolithic function into smaller, single-responsibility helper functions.

**Before:**

- Function length: 537 lines
- Cyclomatic complexity: 71 (limit is 25) ‚ùå
- All logic in one massive function

**After:**

- Main function: 74 lines (86% reduction!)
- Cyclomatic complexity: Well under 25 ‚úÖ
- 10 focused helper functions

**Helper Functions Created:**

1. `_load_data_sources()` - Load SunSpec metadata, M64061, feeds, status data
2. `_extract_point_sets()` - Extract VSN300/VSN700 point sets from JSON files
3. `_process_sunspec_points()` - Process standard SunSpec points
4. `_process_m64061_points()` - Process M64061 proprietary points
5. `_process_abb_proprietary_points()` - Process ABB proprietary points
6. `_process_vsn300_only_points()` - Process VSN300-only points
7. `_process_vsn700_only_points()` - Process VSN700-only points
8. `_process_status_points()` - Process /status endpoint points
9. `_get_cell_value_for_header()` - Map Excel headers to row data values
10. `_create_excel_workbook()` - Create and format Excel workbook

**Benefits:**

- ‚úÖ Single Responsibility - Each function does one thing well
- ‚úÖ Testability - Individual components can be tested independently
- ‚úÖ Maintainability - Easier to understand and modify
- ‚úÖ Readability - Clear function names document intent
- ‚úÖ Code Quality - All ruff checks pass (100% compliance)

#### üìä Mapping Files Regenerated

Regenerated all VSN-SunSpec point mapping files using the refactored code to verify correctness and ensure consistency.

**Files Updated:**

- `docs/vsn-sunspec-point-mapping.xlsx` - Source Excel mapping (258 points)
- `docs/vsn-sunspec-point-mapping.json` - JSON copy for docs (NEW!)
- `custom_components/abb_fimer_pvi_vsn_rest/data/vsn-sunspec-point-mapping.json` - Runtime mapping
- `scripts/vsn-mapping-generator/output/` - Generator output files

**Mapping Statistics:**

- Total unique points: 258
- M1: 6 points
- M103: 23 points
- M160: 6 points
- M64061: 21 points
- VSN300-only: 47 points
- VSN700-only: 142 points
- ABB Proprietary: 14 points

---

## Technical Details

### Files Changed

**Scripts:**

- `scripts/vsn-mapping-generator/__init__.py` (new)
- `scripts/vsn-mapping-generator/extract_manual_changes.py`
- `scripts/vsn-mapping-generator/generate_mapping.py`

**Data Files:**

- `docs/vsn-sunspec-point-mapping.xlsx`
- `docs/vsn-sunspec-point-mapping.json` (new)
- `custom_components/abb_fimer_pvi_vsn_rest/data/vsn-sunspec-point-mapping.json`
- `scripts/vsn-mapping-generator/output/vsn-sunspec-point-mapping.json`
- `scripts/vsn-mapping-generator/output/vsn-sunspec-point-mapping.xlsx`

### Commits Included

1. `b4b83da` - fix(scripts): resolve 21 ruff linting errors in vsn-mapping-generator
2. `0fe5ede` - refactor(scripts): reduce complexity of generate_mapping_excel_complete()
3. `4f407b4` - chore(mapping): regenerate VSN-SunSpec point mapping files

---

## Migration Guide

### For Users

**No action required** - This release contains no changes to integration functionality.

Your existing installation will continue to work without any changes.

### For Developers

**Improved Development Experience:**

1. **Linting**: All scripts now pass ruff linting checks
2. **Code Quality**: Refactored code is easier to understand and maintain
3. **Testing**: Regenerated mapping files verify the refactoring works correctly

**To regenerate mapping files:**

```bash
# Generate Excel from data
cd scripts/vsn-mapping-generator
python generate_mapping.py

# Convert Excel to JSON
python convert_to_json.py
```

---

## Compatibility

- **Home Assistant**: 2024.1.0 or later
- **Python**: 3.11 or later
- **VSN Dataloggers**: VSN300, VSN700
- **Inverters**: ABB, FIMER, Power-One PVI series

---

## Known Issues

None - This release only improves developer tooling.

---

## What's Next

### Planned for v1.0.0-beta.24

- Continue bug fixes and improvements based on user feedback
- Further code quality enhancements as needed

---

## Full Changelog

See [CHANGELOG.md](../../CHANGELOG.md) for complete version history.

---

## Contributors

- **Development**: Claude Code (AI Assistant)
- **Project Maintainer**: @alexdelprete

ü§ñ This release was generated with [Claude Code](https://claude.com/claude-code)
